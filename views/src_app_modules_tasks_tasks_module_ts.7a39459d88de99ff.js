"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([["src_app_modules_tasks_tasks_module_ts"],{8073:(gn,Q,f)=>{f.r(Q),f.d(Q,{TasksModule:()=>dn});var m=f(6978),_=f(8832),W=f(1334),bt=f(3887),K=f(6362),kt=f(3299),c=f(3308),xt=f(7728),t=f(1489),y=f(6104),J=f(8001),Ct=f(756),T=f(8050),q=f(171),k=f(740),vt=f(2811),yt=f(8479),z=f(9874),Z=f(8008);function tt(a,...l){return l.length?l.some(e=>a[e]):a.altKey||a.shiftKey||a.ctrlKey||a.metaKey}var et=f(965),F=f(8486),G=f(1573),nt=f(9606);function Mt(a,l){}class D{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext}let it=(()=>{class a extends T.B{_elementRef=(0,t.WQX)(t.aKT);_focusTrapFactory=(0,t.WQX)(q.F);_config;_interactivityChecker=(0,t.WQX)(q.I);_ngZone=(0,t.WQX)(t.SKi);_overlayRef=(0,t.WQX)(k.c);_focusMonitor=(0,t.WQX)(vt.F);_renderer=(0,t.WQX)(t.sFG);_changeDetectorRef=(0,t.WQX)(t.gRc);_injector=(0,t.WQX)(t.zZn);_platform=(0,t.WQX)(yt.P);_document=(0,t.WQX)(xt.q,{optional:!0});_portalOutlet;_focusTrapped=new y.B;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_isDestroyed=!1;constructor(){super(),this._config=(0,t.WQX)(D,{optional:!0})||new D,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(e){this._ariaLabelledByQueue.push(e),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(e){const n=this._ariaLabelledByQueue.indexOf(e);n>-1&&(this._ariaLabelledByQueue.splice(n,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._focusTrapped.complete(),this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const n=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),n}attachTemplatePortal(e){this._portalOutlet.hasAttached();const n=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),n}attachDomPortal=e=>{this._portalOutlet.hasAttached();const n=this._portalOutlet.attachDomPortal(e);return this._contentAttached(),n};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,n){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const i=()=>{o(),s(),e.removeAttribute("tabindex")},o=this._renderer.listen(e,"blur",i),s=this._renderer.listen(e,"mousedown",i)})),e.focus(n)}_focusByCssSelector(e,n){let i=this._elementRef.nativeElement.querySelector(e);i&&this._forceFocus(i,n)}_trapFocus(e){this._isDestroyed||(0,t.mal)(()=>{const n=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||n.focus(e);break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement(e)||this._focusDialogContainer(e);break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]',e);break;default:this._focusByCssSelector(this._config.autoFocus,e)}this._focusTrapped.next()},{injector:this._injector})}_restoreFocus(){const e=this._config.restoreFocus;let n=null;if("string"==typeof e?n=this._document.querySelector(e):"boolean"==typeof e?n=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(n=e),this._config.restoreFocus&&n&&"function"==typeof n.focus){const i=(0,z.c)(),o=this._elementRef.nativeElement;(!i||i===this._document.body||i===o||o.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(n,this._closeInteractionType),this._closeInteractionType=null):n.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(e){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus(e)}_containsFocus(){const e=this._elementRef.nativeElement,n=(0,z.c)();return e===n||e.contains(n)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,z.c)()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=t.VBU({type:a,selectors:[["cdk-dialog-container"]],viewQuery:function(n,i){if(1&n&&t.GBs(T.f,7),2&n){let o;t.mGM(o=t.lsd())&&(i._portalOutlet=o.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(n,i){2&n&&t.BMQ("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[t.Vt3],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(n,i){1&n&&t.DNE(0,Mt,0,0,"ng-template",0)},dependencies:[T.f],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}\n"],encapsulation:2})}return a})();class V{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new y.B;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(l,e){this.overlayRef=l,this.config=e,this.disableClose=e.disableClose,this.backdropClick=l.backdropClick(),this.keydownEvents=l.keydownEvents(),this.outsidePointerEvents=l.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(n=>{n.keyCode===Z.g&&!this.disableClose&&!tt(n)&&(n.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=l.detachments().subscribe(()=>{!1!==e.closeOnOverlayDetachments&&this.close()})}close(l,e){if(this.containerInstance){const n=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),n.next(l),n.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(l="",e=""){return this.overlayRef.updateSize({width:l,height:e}),this}addPanelClass(l){return this.overlayRef.addPanelClass(l),this}removePanelClass(l){return this.overlayRef.removePanelClass(l),this}}const ot=new t.nKC("DialogScrollStrategy",{providedIn:"root",factory:()=>{const a=(0,t.WQX)(k.a);return()=>a.scrollStrategies.block()}}),Ot=new t.nKC("DialogData"),Tt=new t.nKC("DefaultDialogConfig");let wt=(()=>{class a{_overlay=(0,t.WQX)(k.a);_injector=(0,t.WQX)(t.zZn);_defaultOptions=(0,t.WQX)(Tt,{optional:!0});_parentDialog=(0,t.WQX)(a,{optional:!0,skipSelf:!0});_overlayContainer=(0,t.WQX)(k.O);_idGenerator=(0,t.WQX)(G._);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new y.B;_afterOpenedAtThisLevel=new y.B;_ariaHiddenElements=new Map;_scrollStrategy=(0,t.WQX)(ot);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=(0,J.v)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,et.Z)(void 0)));constructor(){}open(e,n){(n={...this._defaultOptions||new D,...n}).id=n.id||this._idGenerator.getId("cdk-dialog-"),n.id&&this.getDialogById(n.id);const o=this._getOverlayConfig(n),s=this._overlay.create(o),r=new V(s,n),d=this._attachContainer(s,r,n);if(r.containerInstance=d,!this.openDialogs.length){const u=this._overlayContainer.getContainerElement();d._focusTrapped?d._focusTrapped.pipe((0,F.s)(1)).subscribe(()=>{this._hideNonDialogContentFromAssistiveTechnology(u)}):this._hideNonDialogContentFromAssistiveTechnology(u)}return this._attachDialogContent(e,r,d,n),this.openDialogs.push(r),r.closed.subscribe(()=>this._removeOpenDialog(r,!0)),this.afterOpened.next(r),r}closeAll(){L(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(n=>n.id===e)}ngOnDestroy(){L(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),L(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const n=new k.f({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(n.backdropClass=e.backdropClass),n}_attachContainer(e,n,i){const o=i.injector||i.viewContainerRef?.injector,s=[{provide:D,useValue:i},{provide:V,useValue:n},{provide:k.c,useValue:e}];let r;i.container?"function"==typeof i.container?r=i.container:(r=i.container.type,s.push(...i.container.providers(i))):r=it;const d=new T.C(r,i.viewContainerRef,t.zZn.create({parent:o||this._injector,providers:s}));return e.attach(d).instance}_attachDialogContent(e,n,i,o){if(e instanceof t.C4Q){const s=this._createInjector(o,n,i,void 0);let r={$implicit:o.data,dialogRef:n};o.templateContext&&(r={...r,..."function"==typeof o.templateContext?o.templateContext():o.templateContext}),i.attachTemplatePortal(new T.T(e,null,r,s))}else{const s=this._createInjector(o,n,i,this._injector),r=i.attachComponentPortal(new T.C(e,o.viewContainerRef,s));n.componentRef=r,n.componentInstance=r.instance}}_createInjector(e,n,i,o){const s=e.injector||e.viewContainerRef?.injector,r=[{provide:Ot,useValue:e.data},{provide:V,useValue:n}];return e.providers&&("function"==typeof e.providers?r.push(...e.providers(n,e,i)):r.push(...e.providers)),e.direction&&(!s||!s.get(nt.D,null,{optional:!0}))&&r.push({provide:nt.D,useValue:{value:e.direction,change:(0,Ct.of)()}}),t.zZn.create({parent:s||o,providers:r})}_removeOpenDialog(e,n){const i=this.openDialogs.indexOf(e);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((o,s)=>{o?s.setAttribute("aria-hidden",o):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),n&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(e){if(e.parentElement){const n=e.parentElement.children;for(let i=n.length-1;i>-1;i--){const o=n[i];o!==e&&"SCRIPT"!==o.nodeName&&"STYLE"!==o.nodeName&&!o.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(n){return new(n||a)};static \u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();function L(a,l){let e=a.length;for(;e--;)l(a[e])}var at=f(6318),Dt=f(2489),E=f(8503);function jt(a,l){}f(3543);class st{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration}const $="mdc-dialog--open",rt="mdc-dialog--opening",lt="mdc-dialog--closing";let dt=(()=>{class a extends it{_animationMode=(0,t.WQX)(t.bc$,{optional:!0});_animationStateChanged=new t.bkB;_animationsEnabled="NoopAnimations"!==this._animationMode;_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?pt(this._config.enterAnimationDuration)??150:0;_exitAnimationDuration=this._animationsEnabled?pt(this._config.exitAnimationDuration)??75:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(ct,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(rt,$)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add($),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove($),this._animationsEnabled?(this._hostElement.style.setProperty(ct,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(lt)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(e){this._actionSectionCount+=e,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(rt,lt)}_waitForAnimationToComplete(e,n){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(n,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(e):e()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}attachComponentPortal(e){const n=super.attachComponentPortal(e);return n.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),n}static \u0275fac=(()=>{let e;return function(i){return(e||(e=t.xGo(a)))(i||a)}})();static \u0275cmp=t.VBU({type:a,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(n,i){2&n&&(t.Mr5("id",i._config.id),t.BMQ("aria-modal",i._config.ariaModal)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),t.AVh("_mat-animation-noopable",!i._animationsEnabled)("mat-mdc-dialog-container-with-actions",i._actionSectionCount>0))},features:[t.Vt3],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,jt,0,0,"ng-template",2),t.k0s()())},dependencies:[T.f],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}\n'],encapsulation:2})}return a})();const ct="--mat-dialog-transition-duration";function pt(a){return null==a?null:"number"==typeof a?a:a.endsWith("ms")?(0,at.c)(a.substring(0,a.length-2)):a.endsWith("s")?1e3*(0,at.c)(a.substring(0,a.length-1)):"0"===a?0:null}var R=function(a){return a[a.OPEN=0]="OPEN",a[a.CLOSING=1]="CLOSING",a[a.CLOSED=2]="CLOSED",a}(R||{});class O{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new y.B;_beforeClosed=new y.B;_result;_closeFallbackTimeout;_state=R.OPEN;_closeInteractionType;constructor(l,e,n){this._ref=l,this._containerInstance=n,this.disableClose=e.disableClose,this.id=l.id,l.addPanelClass("mat-mdc-dialog-panel"),n._animationStateChanged.pipe((0,E.p)(i=>"opened"===i.state),(0,F.s)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe((0,E.p)(i=>"closed"===i.state),(0,F.s)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),l.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),(0,Dt.h)(this.backdropClick(),this.keydownEvents().pipe((0,E.p)(i=>i.keyCode===Z.g&&!this.disableClose&&!tt(i)))).subscribe(i=>{this.disableClose||(i.preventDefault(),function gt(a,l,e){return a._closeInteractionType=l,a.close(e)}(this,"keydown"===i.type?"keyboard":"mouse"))})}close(l){this._result=l,this._containerInstance._animationStateChanged.pipe((0,E.p)(e=>"closing"===e.state),(0,F.s)(1)).subscribe(e=>{this._beforeClosed.next(l),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=R.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(l){let e=this._ref.config.positionStrategy;return l&&(l.left||l.right)?l.left?e.left(l.left):e.right(l.right):e.centerHorizontally(),l&&(l.top||l.bottom)?l.top?e.top(l.top):e.bottom(l.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(l="",e=""){return this._ref.updateSize(l,e),this}addPanelClass(l){return this._ref.addPanelClass(l),this}removePanelClass(l){return this._ref.removePanelClass(l),this}getState(){return this._state}_finishDialogClose(){this._state=R.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}const P=new t.nKC("MatMdcDialogData"),Rt=new t.nKC("mat-mdc-dialog-default-options"),ft=new t.nKC("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{const a=(0,t.WQX)(k.a);return()=>a.scrollStrategies.block()}});let A=(()=>{class a{_overlay=(0,t.WQX)(k.a);_defaultOptions=(0,t.WQX)(Rt,{optional:!0});_scrollStrategy=(0,t.WQX)(ft);_parentDialog=(0,t.WQX)(a,{optional:!0,skipSelf:!0});_idGenerator=(0,t.WQX)(G._);_dialog=(0,t.WQX)(wt);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new y.B;_afterOpenedAtThisLevel=new y.B;dialogConfigClass=st;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=(0,J.v)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,et.Z)(void 0)));constructor(){this._dialogRefConstructor=O,this._dialogContainerType=dt,this._dialogDataToken=P}open(e,n){let i;(n={...this._defaultOptions||new st,...n}).id=n.id||this._idGenerator.getId("mat-mdc-dialog-"),n.scrollStrategy=n.scrollStrategy||this._scrollStrategy();const o=this._dialog.open(e,{...n,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:n},{provide:D,useValue:n}]},templateContext:()=>({dialogRef:i}),providers:(s,r,d)=>(i=new this._dialogRefConstructor(s,n,d),i.updatePosition(n?.position),[{provide:this._dialogContainerType,useValue:d},{provide:this._dialogDataToken,useValue:r.data},{provide:this._dialogRefConstructor,useValue:i}])});return i.componentRef=o.componentRef,i.componentInstance=o.componentInstance,this.openDialogs.push(i),this.afterOpened.next(i),i.afterClosed().subscribe(()=>{const s=this.openDialogs.indexOf(i);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||this._getAfterAllClosed().next())}),i}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(n=>n.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let n=e.length;for(;n--;)e[n].close()}static \u0275fac=function(n){return new(n||a)};static \u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})(),w=(()=>{class a{constructor(){this.COLORS=[{bg:"#fce7f3",color:"#be185d"},{bg:"#e0f2fe",color:"#0369a1"},{bg:"#fef3c7",color:"#b45309"},{bg:"#dcfce7",color:"#15803d"},{bg:"#ede9fe",color:"#6d28d9"},{bg:"#fff6e8",color:"#b86f00"},{bg:"#f3e8ff",color:"#7b4dd9"},{bg:"#ffeef0",color:"#b23b4a"},{bg:"#dbeafe",color:"#1d4ed8"},{bg:"#fee2e2",color:"#b91c1c"},{bg:"#e6ffed",color:"#059669"}],this.INITIAL_TASKS=[{id:"t1",title:"Wireframing",description:"Create low-fidelity designs that outline the basic structure and layout of the product or service...",tag:{id:"id1",name:"UX stages",bg:"#fff6e8",color:"#b86f00"},checklist:[{id:"c1",name:"toto",done:{ok:!0,by:"7",at:Date.now()},created:{by:"c0",at:Date.now()}},{id:"c2",name:"momo",done:{ok:!0,by:"7",at:Date.now()},created:{by:"c0",at:Date.now()}}],views:{7:{at:1675265265},2:{at:1675551515}},attachments:{7:{at:1675265265,files:[{url:"https://toto.tg",id:"",size:0}]}},columnId:"todo",owner:"1",createdAt:Date.now(),updatedBy:"1",updatedAt:Date.now(),priority:void 0,comments:[]},{id:"t2",title:"First design concept",description:"Create a concept based on the research and insights gathered during the discovery phase of the project...",tag:{id:"id2",name:"Design",bg:"#f3e8ff",color:"#7b4dd9"},checklist:[{id:"c1",name:"Sketch",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c2",name:"Review",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c3",name:"Feedback",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c4",name:"Finalize",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()}},comments:[],attachments:{},columnId:"todo",owner:"2",createdAt:Date.now(),updatedBy:"2",updatedAt:Date.now(),priority:void 0},{id:"t3",title:"Design library",description:"Create a collection of reusable design elements...",tag:{id:"id3",name:"Design",bg:"#f3e8ff",color:"#7b4dd9"},checklist:[],views:{1:{at:Date.now()}},comments:[],attachments:{1:{at:Date.now(),files:[{url:"https://cdn.design-system.com/ui-kit",id:"",size:0}]}},columnId:"todo",owner:"2",createdAt:Date.now(),updatedBy:"3",updatedAt:Date.now(),priority:void 0},{id:"t4",title:"Customer Journey Mapping",description:"Identify the key touchpoints and pain points in the customer journey...",tag:{id:"id4",name:"UX stages",bg:"#fff6e8",color:"#b86f00"},checklist:[{id:"c1",name:"Interviews",done:{ok:!0,by:"2",at:Date.now()},created:{by:"",at:0}},{id:"c2",name:"Touchpoints",done:{ok:!0,by:"3",at:Date.now()},created:{by:"",at:0}},{id:"c3",name:"Pain points",done:{ok:!0,by:"3",at:Date.now()},created:{by:"",at:0}},{id:"c4",name:"Opportunities",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c5",name:"Journey map",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c6",name:"Validation",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c7",name:"Iteration",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c8",name:"Final map",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c9",name:"Presentation",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c10",name:"Approval",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()},2:{at:Date.now()},3:{at:Date.now()},4:{at:Date.now()},5:{at:Date.now()},6:{at:Date.now()}},comments:[],attachments:{},columnId:"inprogress",owner:"3",createdAt:Date.now(),updatedBy:"4",updatedAt:Date.now(),priority:void 0},{id:"t5",title:"Persona development",description:"Create user personas based on the research data to represent different user groups...",tag:{id:"id5",name:"UX stages",bg:"#fff6e8",color:"#b86f00"},checklist:[{id:"c1",name:"Identify user groups",done:{ok:!0,by:"1",at:Date.now()},created:{by:"",at:0}},{id:"c2",name:"Draft personas",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()},2:{at:Date.now()}},comments:[],attachments:{1:{at:Date.now(),files:[{url:"https://persona-template.pdf",id:"",size:0}]}},columnId:"inprogress",owner:"2",createdAt:Date.now(),updatedBy:"2",updatedAt:Date.now(),priority:void 0},{id:"t6",title:"Competitor research",description:"Research competitors and identify weakness and strengths each of them...",tag:{id:"id6",name:"UX stages",bg:"#fff6e8",color:"#b86f00"},checklist:[{id:"c1",name:"Collect competitors",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c2",name:"Analyze strengths",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c3",name:"Analyze weaknesses",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c4",name:"Compare features",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c5",name:"SWOT analysis",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c6",name:"Market position",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c7",name:"Report",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()},2:{at:Date.now()},3:{at:Date.now()},4:{at:Date.now()}},comments:[],attachments:{1:{at:Date.now(),files:[{url:"https://competitor-analysis.pdf",id:"",size:0}]}},columnId:"needreview",owner:"5",createdAt:Date.now(),updatedBy:"5",updatedAt:Date.now(),priority:void 0},{id:"t7",title:"Branding, visual identity",description:"Create a brand identity system that includes a logo, typography, color palette, and brand guidelines...",tag:{id:"id7",name:"Branding",bg:"#ffeef0",color:"#b23b4a"},checklist:[{id:"c1",name:"Logo",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c2",name:"Typography",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c3",name:"Guidelines",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()},2:{at:Date.now()},3:{at:Date.now()}},comments:[],attachments:{},columnId:"done",owner:"3",createdAt:Date.now(),updatedBy:"3",updatedAt:Date.now(),priority:void 0},{id:"t8",title:"Marketing materials",description:"Create branded materials such as business cards, flyers, brochures, and social media graphics...",tag:{id:"id8",name:"Branding",bg:"#ffeef0",color:"#b23b4a"},checklist:[{id:"c1",name:"Business cards",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c2",name:"Flyers",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c3",name:"Brochures",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c4",name:"Social media graphics",done:{ok:!1,by:"",at:0},created:{by:"",at:0}},{id:"c5",name:"Print templates",done:{ok:!1,by:"",at:0},created:{by:"",at:0}}],views:{1:{at:Date.now()},2:{at:Date.now()}},comments:[],attachments:{1:{at:Date.now(),files:[{url:"https://marketing-kit.zip",id:"",size:0}]}},columnId:"done",owner:"4",createdAt:Date.now(),updatedBy:"4",updatedAt:Date.now(),priority:void 0}],this.defaultPriority={id:"low",name:"Low",label:"Low",big:{color:"#065f46",bg:"#d1fae5"},small:{color:"#047857",bg:"#a7f3d0"}},this.prioritiesList=[this.defaultPriority,{id:"med",name:"Medium",label:"Medium",big:{color:"#78350f",bg:"#ffedd5"},small:{color:"#b45309",bg:"#fed7aa"}},{id:"high",name:"High",label:"High",big:{color:"#9b1232",bg:"#fee2e2"},small:{color:"#b91c1c",bg:"#fca5a5"}}],this.defaultTag={id:"tag1",name:"New",bg:this.withOpacity("#059669",.15),color:"#065f46"},this.tagsList=[this.defaultTag,{id:"tag2",name:"UX stages",bg:this.withOpacity("#b86f00",.15),color:"#92400e"},{id:"tag3",name:"Design",bg:this.withOpacity("#7b4dd9",.15),color:"#5b21b6"},{id:"tag4",name:"Branding",bg:this.withOpacity("#b23b4a",.15),color:"#991b1b"}]}getColor(){return this.COLORS[Math.floor(Math.random()*this.COLORS.length)]}withOpacity(e,n){return 3===(e=e.replace("#","")).length&&(e=e.split("").map(o=>o+o).join("")),n=Math.max(0,Math.min(1,n)),`#${e}${Math.round(255*n).toString(16).padStart(2,"0")}`}getTagStyle(e){const n=this.tagsList.find(i=>i.name.toLowerCase()===e.toLowerCase());return n?{backColor:n.bg,textColor:n.color}:{backColor:"#f1f5f9",textColor:"#334155"}}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var _t=f(5981),Vt=f(946),N=f(446),I=f(6246),x=f(620);let X=(()=>{class a{constructor(e,n,i){this.api=e,this.socket=n,this.userCtx=i,this._users$=new _t.t(null),this.users$=this._users$.asObservable().pipe((0,Vt.t)(1)),this.ready=new Promise(o=>this._readyResolve=o),this.getUsers().then(o=>{this._users$.next(o??null),this._readyResolve()})}getUsers(){var e=this;return(0,c.A)(function*(n=!1){const{uid:i}=e.userCtx.requireUser();return i?(yield e.api.list("users",n)).filter(d=>!0).sort((d,u)=>(d.displayName||d.email).localeCompare(u.displayName||u.email)):[]}).apply(this,arguments)}syncFromServer(){var e=this;return(0,c.A)(function*(){return yield e.api.syncFromServer("users")})()}static{this.\u0275fac=function(n){return new(n||a)(t.KVO(N.s),t.KVO(I.L),t.KVO(x.i))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function Lt(a,l){if(1&a&&(t.j41(0,"option",20),t.EFF(1),t.k0s()),2&a){const e=l.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.label)}}function $t(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",16)(1,"label",17),t.EFF(2,"Priority"),t.k0s(),t.j41(3,"select",18),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.filter.priority,i)||(o.filter.priority=i),t.Njj(i)}),t.DNE(4,Lt,2,2,"option",19),t.k0s()()}if(2&a){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filter.priority),t.R7$(),t.Y8G("ngForOf",e.prioritiesList)}}function Nt(a,l){if(1&a&&(t.j41(0,"option",20),t.EFF(1),t.k0s()),2&a){const e=l.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.label)}}function Xt(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",16)(1,"label",21),t.EFF(2,"Assign\xe9 \xe0"),t.k0s(),t.j41(3,"select",22),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.filter.assigned,i)||(o.filter.assigned=i),t.Njj(i)}),t.DNE(4,Nt,2,2,"option",19),t.k0s()()}if(2&a){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filter.assigned),t.R7$(),t.Y8G("ngForOf",e.assignedList)}}function Ut(a,l){if(1&a&&(t.j41(0,"option",20),t.EFF(1),t.k0s()),2&a){const e=l.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.label)}}function Yt(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",16)(1,"label",23),t.EFF(2,"\xc9tiquette"),t.k0s(),t.j41(3,"select",24),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.filter.tag,i)||(o.filter.tag=i),t.Njj(i)}),t.DNE(4,Ut,2,2,"option",19),t.k0s()()}if(2&a){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filter.tag),t.R7$(),t.Y8G("ngForOf",e.tagsList)}}let Ht=(()=>{class a{constructor(e,n,i,o,s){this.provider=e,this.userService=n,this.userCtx=i,this.dialogRef=o,this.data=s,this.prioritiesList=[],this.assignedList=[],this.tagsList=[]}ngOnInit(){this.initialiseApp()}ngOnDestroy(){}initialiseApp(){var e=this;return(0,c.A)(function*(){const{uid:n}=e.userCtx.requireUser();e.userId=n;const i=yield e.userService.getUsers();e.assignedList=i.map(o=>({value:o.uid,label:`${o.displayName??""}  ${o.email?"("+o.email+")":""}`})),e.tagsList=e.provider.tagsList.map(o=>({value:o.id,label:o.name})),e.prioritiesList=e.provider.prioritiesList.map(o=>({value:o.id,label:o.name})),e.filter=e.data.filter||{priority:null,assigned:null,tag:null,startDate:null,endDate:null}})()}onApply(){this.filter.startDate&&this.filter.endDate&&this.filter.startDate>this.filter.endDate?alert("La date de d\xe9but ne peut pas \xeatre post\xe9rieure \xe0 la date de fin."):this.dialogRef.close(this.filter)}onClose(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(w),t.rXU(X),t.rXU(x.i),t.rXU(O),t.rXU(P))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-task-filter-modal"]],inputs:{userId:"userId",filter:"filter"},standalone:!1,decls:28,vars:5,consts:[[1,"modal-backdrop",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"fas","fa-filter"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"filters"],["class","filter",4,"ngIf"],[1,"filter","date-range"],[1,"date-inputs"],["type","date",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"btn","cancel",3,"click"],[1,"fas","fa-times"],[1,"btn","apply",3,"click"],[1,"fas","fa-check"],[1,"filter"],["for","status"],["id","status","multiple","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["for","assigned"],["id","assigned","multiple","",3,"ngModelChange","ngModel"],["for","tag"],["id","tag","multiple","",3,"ngModelChange","ngModel"]],template:function(n,i){1&n&&(t.j41(0,"div",0),t.bIt("click",function(){return i.onClose()}),t.k0s(),t.j41(1,"div",1),t.bIt("click",function(s){return s.stopPropagation()}),t.j41(2,"header",2)(3,"h2"),t.nrm(4,"i",3),t.EFF(5," Filtrer les t\xe2ches"),t.k0s(),t.j41(6,"button",4),t.bIt("click",function(){return i.onClose()}),t.EFF(7,"\xd7"),t.k0s()(),t.j41(8,"div",5)(9,"div",6),t.DNE(10,$t,5,2,"div",7)(11,Xt,5,2,"div",7)(12,Yt,5,2,"div",7),t.j41(13,"div",8)(14,"label"),t.EFF(15,"Date d\u2019\xe9ch\xe9ance (entre)"),t.k0s(),t.j41(16,"div",9)(17,"input",10),t.mxI("ngModelChange",function(s){return t.DH7(i.filter.startDate,s)||(i.filter.startDate=s),s}),t.k0s(),t.j41(18,"span"),t.EFF(19,"et"),t.k0s(),t.j41(20,"input",10),t.mxI("ngModelChange",function(s){return t.DH7(i.filter.endDate,s)||(i.filter.endDate=s),s}),t.k0s()()()()(),t.j41(21,"footer",11)(22,"button",12),t.bIt("click",function(){return i.onClose()}),t.nrm(23,"i",13),t.EFF(24," Annuler "),t.k0s(),t.j41(25,"button",14),t.bIt("click",function(){return i.onApply()}),t.nrm(26,"i",15),t.EFF(27," Appliquer "),t.k0s()()()),2&n&&(t.R7$(10),t.Y8G("ngIf",i.prioritiesList.length>0),t.R7$(),t.Y8G("ngIf",i.assignedList.length>0),t.R7$(),t.Y8G("ngIf",i.tagsList.length>0),t.R7$(5),t.R50("ngModel",i.filter.startDate),t.R7$(3),t.R50("ngModel",i.filter.endDate))},dependencies:[m.Sq,m.bT,_.xH,_.y7,_.me,_.W0,_.BC,_.vS],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;backdrop-filter:blur(1px);z-index:999;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .25s ease}.modal[_ngcontent-%COMP%]{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:14px;width:460px;max-width:95%;box-shadow:0 4px 18px #00000014;overflow:hidden;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_popIn .3s ease;z-index:1000}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(90deg,#007bff,#4e9bff);padding:16px 20px;color:#fff}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:8px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem;opacity:.9}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{border:none;background:#ffffff26;color:#fff;font-size:1.4rem;line-height:1;border-radius:50%;width:32px;height:32px;cursor:pointer;transition:background .2s}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.modal-body[_ngcontent-%COMP%]{padding:22px 24px;background:#fff}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:18px}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]{display:flex;flex-direction:column}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.95rem;color:#333;margin-bottom:6px;font-weight:500}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #e1e3e8;border-radius:8px;font-size:.95rem;background-color:#f8f9fb;transition:border-color .2s ease,box-shadow .2s ease}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 3px #007bff26;background-color:#fff}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   select[multiple][_ngcontent-%COMP%]{min-height:100px;padding:10px}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .date-range[_ngcontent-%COMP%]   .date-inputs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .date-range[_ngcontent-%COMP%]   .date-inputs[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#666;font-size:.9rem}.modal-body[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .date-range[_ngcontent-%COMP%]   .date-inputs[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{flex:1}.modal-footer[_ngcontent-%COMP%]{background:#f8f9fb;padding:14px 20px;display:flex;justify-content:flex-end;gap:12px;border-top:1px solid #e1e3e8}.modal-footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:.95rem;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;transition:all .25s ease;font-weight:500}.modal-footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.modal-footer[_ngcontent-%COMP%]   .btn.cancel[_ngcontent-%COMP%]{background:#f0f0f0;color:#333}.modal-footer[_ngcontent-%COMP%]   .btn.cancel[_ngcontent-%COMP%]:hover{background:#e2e2e2}.modal-footer[_ngcontent-%COMP%]   .btn.apply[_ngcontent-%COMP%]{background:#007bff;color:#fff;box-shadow:0 3px 10px #007bff4d}.modal-footer[_ngcontent-%COMP%]   .btn.apply[_ngcontent-%COMP%]:hover{background:#0067d6;box-shadow:0 3px 10px #007bff66}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_popIn{0%{transform:translate(-50%,-45%) scale(.96);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}select[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}select[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:4px}"],changeDetection:0})}}return a})(),j=(()=>{class a{constructor(e,n,i){this.api=e,this.socket=n,this.userCtx=i,this.socket.on("tasks:created",o=>this.syncToServer()),this.socket.on("tasks:updated",o=>this.syncToServer()),this.socket.on("tasks:moved",o=>this.syncToServer()),this.socket.on("tasks:deleted",o=>this.syncToServer()),this.socket.on("tasks:synced",o=>this.afterSync(o))}save(e){var n=this;return(0,c.A)(function*(i,o=!1){return yield n.api.save("tasks",i)}).apply(this,arguments)}bulkSave(e){var n=this;return(0,c.A)(function*(i,o=!1){return yield n.api.bulkSave("tasks",i,o)}).apply(this,arguments)}syncToServer(){var e=this;return(0,c.A)(function*(){return yield e.api.syncToServer("tasks")})()}syncFromServer(){var e=this;return(0,c.A)(function*(){return yield e.api.syncFromServer("tasks")})()}afterSync(e){var n=this;return(0,c.A)(function*(){return yield n.api.afterSync("tasks",e)})()}list(){var e=this;return(0,c.A)(function*(n=!1){const i=e.userCtx.requireUser();return i?.uid?(yield e.api.list("tasks",n)).filter(r=>{if(i.isAdmin)return!0;const d=[...Object.keys(r.assignTo??{}),...Object.keys(r.sharedWith??{})];return r.owner===i.uid||d.includes(i.uid)}).sort((r,d)=>(r.position??0)-(d.position??0)):[]}).apply(this,arguments)}get(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=n.userCtx.requireUser();if(!s?.uid)return;const r=yield n.api.get("tasks",i,o);if(!r)return;const d=[...Object.keys(r.assignTo??{}),...Object.keys(r.sharedWith??{})];return s.isAdmin||r.owner===s.uid||d.includes(s.uid)?r:void 0}catch(s){return void console.error("Erreur getById",s)}}).apply(this,arguments)}bulkGet(e){var n=this;return(0,c.A)(function*(i,o=!1){try{return yield n.api.bulkGet("tasks",i,o)}catch(s){return console.error("Erreur getById",s),[]}}).apply(this,arguments)}getByField(e,n){var i=this;return(0,c.A)(function*(o,s,r=!1){try{const d=i.userCtx.requireUser();return d?.uid?(yield i.api.getByField("tasks",o,s,r)).filter(p=>{if(d.isAdmin)return!0;const g=[...Object.keys(p.assignTo??{}),...Object.keys(p.sharedWith??{})];return p.owner===d.uid||g.includes(d.uid)}).sort((p,g)=>(p.position??0)-(g.position??0)):[]}catch(d){return console.error("Erreur list tasks",d),[]}}).apply(this,arguments)}update(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=n.userCtx.requireUser();if(!s?.uid)throw new Error("Utilisateur non authentifi\xe9");if(!s.isAdmin&&i.owner!==s.uid)throw new Error("Permission refus\xe9e");const r=yield n.api.update("tasks",i,o);return r&&n.syncToServer(),r}catch(s){throw console.error("Erreur update task",s),s}}).apply(this,arguments)}saveOrUpdate(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=n.userCtx.requireUser();if(!s?.uid)throw new Error("Utilisateur non authentifi\xe9");if((i.id?yield n.api.get("tasks",i.id,o):void 0)&&!s.isAdmin&&i.owner!==s.uid)throw new Error("Permission refus\xe9e");const d=yield n.api.saveOrUpdate("tasks",i,o);return d&&n.syncToServer(),d}catch(s){return console.error("[saveOrUpdate] Failed:",s),!1}}).apply(this,arguments)}delete(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=n.userCtx.requireUser();if(!s?.uid)return!1;const r=yield n.api.get("tasks",i,o);if(!r)throw new Error("Task not found");if(!s.isAdmin&&r.owner!==s.uid)throw new Error("Permission refus\xe9e");const u=yield n.api.delete("tasks",i,o);return u&&n.syncToServer(),u}catch(s){return console.error("Erreur delete task",s),!1}}).apply(this,arguments)}moveTask(e,n,i,o){var s=this;return(0,c.A)(function*(r,d,u,h,p=!1){try{const g=yield s.get(r,p);if(!g)return void console.warn(`[moveTask] Task ${r} not found`);const v=((yield s.getByField("columnId",d,p))??[]).filter(S=>S.id!==r),M=Math.max(0,Math.min(h??v.length,v.length)),B={...g,columnId:d,moovedAt:Date.now(),synced:!1},ht=[...[...v.slice(0,M),B,...v.slice(M)].map((S,Y)=>({...S,order:Y}))];if(g.columnId!==d){const Y=((yield s.getByField("columnId",g.columnId,p))??[]).filter(H=>H.id!==r).map((H,pn)=>({...H,order:pn}));ht.push(...Y)}const cn=yield s.bulkSave(ht,p);s.socket&&s.socket.emit("tasks:moved",{taskId:r,toColumnId:d,insertIndex:M}),cn&&s.syncToServer(),console.info(`[moveTask] Task ${r} moved to column ${d} at index ${M}`)}catch(g){throw console.error("[moveTask] Failed to move task:",g),g}}).apply(this,arguments)}markAsCompleted(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=yield n.get(i,o);if(!s)throw new Error("Task not found");s.status="completed";const r=yield n.update(s,o);return r&&n.syncToServer(),r}catch(s){return console.error("Erreur markAsCompleted",s),!1}}).apply(this,arguments)}shareTask(e,n){var i=this;return(0,c.A)(function*(o,s,r=!1){try{const d=yield i.get(o,r);if(!d)throw new Error("Task not found");const u=Date.now(),h={};for(const g of s)h[g]={at:u};d.sharedWith={...d.sharedWith,...h};const p=yield i.update(d,r);return p&&i.syncToServer(),p}catch(d){return console.error("Erreur shareTask",d),!1}}).apply(this,arguments)}unshareTask(e,n){var i=this;return(0,c.A)(function*(o,s,r=!1){try{const d=yield i.get(o,r);if(!d)throw new Error("Task not found");d.sharedWith=d.sharedWith?Object.fromEntries(Object.entries(d.sharedWith).filter(([h])=>!s.includes(h))):void 0;const u=yield i.update(d,r);return u&&i.syncToServer(),u}catch(d){return console.error("Erreur unshareTask",d),!1}}).apply(this,arguments)}archiveTask(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=yield n.get(i,o);if(!s)throw new Error("Task not found");s.archived=!0;const r=yield n.update(s,o);return r&&n.syncToServer(),r}catch(s){return console.error("Erreur archiveTask",s),!1}}).apply(this,arguments)}restoreTask(e){var n=this;return(0,c.A)(function*(i,o=!1){try{const s=yield n.get(i,o);if(!s)throw new Error("Task not found");s.archived=!1;const r=yield n.update(s,o);return r&&n.syncToServer(),r}catch(s){return console.error("Erreur restoreTask",s),!1}}).apply(this,arguments)}getRecentTasks(){var e=this;return(0,c.A)(function*(n=10,i=!1){return(yield e.list(i)).sort((s,r)=>(r.updatedAt??0)-(s.updatedAt??0)).slice(0,n)}).apply(this,arguments)}filterByStatus(e){var n=this;return(0,c.A)(function*(i,o=!1){return(yield n.list(o)).filter(r=>r.status===i)}).apply(this,arguments)}search(e){var n=this;return(0,c.A)(function*(i,o=!1){return(yield n.list(o)).filter(r=>r.title?.toLowerCase().includes(i.toLowerCase()))}).apply(this,arguments)}updateLocal(e,n=!1){}deleteLocal(e,n=!1){}static{this.\u0275fac=function(n){return new(n||a)(t.KVO(N.s),t.KVO(I.L),t.KVO(x.i))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})(),Qt=(()=>{class a{constructor(e,n,i){this.api=e,this.userCtx=n,this.socket=i,this.socket.on("columns:updated",o=>this.updateLocal(o)),this.socket.on("columns:deleted",o=>this.deleteLocal(o))}buildColumns(e,n){return e.map(i=>({...i,tasks:n.filter(o=>o.columnId===i.id)}))}save(e){var n=this;return(0,c.A)(function*(){return yield n.api.save("columns",e)})()}bulkSave(e){var n=this;return(0,c.A)(function*(){return yield n.api.bulkSave("columns",e)})()}syncToServer(){var e=this;return(0,c.A)(function*(){return yield e.api.syncToServer("columns")})()}list(){return(0,c.A)(function*(){return[{id:"todo",title:"To Do",color:"#ff6b6b"},{id:"inprogress",title:"In Progress",color:"#5b8cff"},{id:"needreview",title:"Need Review",color:"#ffb020"},{id:"done",title:"Done",color:"#00c48c"}]})()}get(e){var n=this;return(0,c.A)(function*(){if(n.userCtx.currentUser)return yield n.api.get("columns",e)})()}update(e){var n=this;return(0,c.A)(function*(){return yield n.api.update("columns",e)})()}delete(e){var n=this;return(0,c.A)(function*(){try{const i=n.userCtx.requireUser();if(!i?.uid)return!1;const o=yield n.api.get("columns",e);if(!o)throw new Error("Task not found");if(!i.isAdmin&&o.owner!==i.uid)throw new Error("Permission refus\xe9e");return yield n.api.delete("columns",e)}catch(i){return console.error("Erreur delete columns",i),!1}})()}shareColumn(e,n){return(0,c.A)(function*(){})()}unshareColumn(e,n){return(0,c.A)(function*(){})()}archiveColumn(e){return(0,c.A)(function*(){})()}restoreColumn(e){return(0,c.A)(function*(){})()}updateLocal(e){}deleteLocal(e){}static{this.\u0275fac=function(n){return new(n||a)(t.KVO(N.s),t.KVO(x.i),t.KVO(I.L))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var C=f(1064),Wt=f(8629);let Kt=(()=>{class a{constructor(e,n){this.http=e,this.socket=n,this.modalSubject=new y.B,this.tableName="tasks",this.base=Wt.c.backendUrl}getComments(e,n){return this.http.get(`${this.base}/api/${this.tableName}/${e}/comments`,n)}addComment(e,n,i){return this.http.post(`${this.base}/api/${this.tableName}/${e}/comments`,n,i)}updateComment(e,n,i){return this.http.put(`${this.base}/api/${this.tableName}/${e}/comments/${n.id}`,n,i)}deleteComment(e,n,i){return this.http.delete(`${this.base}/api/${this.tableName}/${e}/comments/${n}`,i)}listenComments(e){return this.socket.onComment(e)}emitComment(e,n){this.socket.emitComment({...n,taskId:e})}emitCommentUpdate(e,n){this.socket.emit("comments:update",{...n,taskId:e})}emitCommentDelete(e,n){this.socket.emit("comments:delete",{...n,taskId:e})}closeModal(){this.modalSubject.next()}onModalClose(){return this.modalSubject.asObservable()}static{this.\u0275fac=function(n){return new(n||a)(t.KVO(W.Qq),t.KVO(I.L))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();const Jt=["scrollMe"],qt=(a,l,e)=>({outgoing:a,incoming:l,deleted:e});function Zt(a,l){1&a&&(t.j41(0,"div",18),t.EFF(1,"Chargement..."),t.k0s())}function te(a,l){if(1&a&&t.nrm(0,"img",37),2&a){const e=t.XpG().$implicit;t.Y8G("src",e.photoURL,t.B4B)}}function ee(a,l){if(1&a&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"slice"),t.nI1(3,"uppercase"),t.k0s()),2&a){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.bMT(3,5,t.brH(2,1,e.by,0,2)))}}function ne(a,l){1&a&&(t.j41(0,"span",38),t.EFF(1,"\u2714\u2714"),t.k0s())}function ie(a,l){if(1&a&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&a){const e=l.$implicit;t.R7$(),t.JRh(e)}}function oe(a,l){if(1&a&&(t.j41(0,"div",39),t.DNE(1,ie,2,1,"span",40),t.k0s()),2&a){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",e.reactions)}}function ae(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",19)(1,"div",20)(2,"div",21)(3,"div",22),t.DNE(4,te,1,1,"img",23)(5,ee,4,7,"ng-template",null,1,t.C5r),t.k0s(),t.j41(7,"div",24),t.qex(8),t.j41(9,"span",25),t.EFF(10),t.k0s(),t.bVm(),t.k0s()(),t.j41(11,"div",26)(12,"div",27)(13,"i",28),t.EFF(14),t.k0s(),t.j41(15,"i",29),t.EFF(16),t.nI1(17,"date"),t.k0s()(),t.DNE(18,ne,2,0,"span",30)(19,oe,2,1,"div",31),t.k0s(),t.j41(20,"div",32)(21,"button",16),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.addReaction(i,"\u{1f44d}"))}),t.EFF(22,"\u{1f44d}"),t.k0s(),t.j41(23,"button",16),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.addReaction(i,"\u2764\ufe0f"))}),t.EFF(24,"\u2764\ufe0f"),t.k0s(),t.j41(25,"button",16),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.addReaction(i,"\u{1f602}"))}),t.EFF(26,"\u{1f602}"),t.k0s(),t.j41(27,"button",33),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.editComment(i))}),t.nrm(28,"i",34),t.k0s(),t.j41(29,"button",35),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.deleteComment(i))}),t.nrm(30,"i",36),t.k0s()()()()}if(2&a){const e=l.$implicit,n=t.sdS(6),i=t.XpG();t.Y8G("ngClass",t.sMw(13,qt,e.by===i.user.uid,e.by!==i.user.uid,e.deleted))("@fadeIn",void 0),t.R7$(4),t.Y8G("ngIf",e.photoURL)("ngIfElse",n),t.R7$(3),t.Y8G("@bubbleAnim",void 0),t.R7$(3),t.JRh(e.msg),t.R7$(4),t.SpI("",e.by===i.user.uid?"Vous":e.by," \xe0 "),t.R7$(2),t.SpI(" ",t.i5U(17,10,e.at,"shortTime"),""),t.R7$(2),t.Y8G("ngIf",!e.seen),t.R7$(),t.Y8G("ngIf",!e.deleted)}}function se(a,l){if(1&a&&(t.j41(0,"div",41),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.SpI(" ",e.typingUser," est en train d\u2019\xe9crire... ")}}function re(a,l){if(1&a){const e=t.RV6();t.j41(0,"button",42),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.cancelSelected())}),t.EFF(1,"X"),t.k0s()}}let le=(()=>{class a{constructor(e,n,i,o,s,r){this.socket=e,this.commentService=n,this.taskService=i,this.userCtx=o,this.dialogRef=s,this.data=r,this.comments$=new _t.t([]),this.newComment="",this.typingUser=null,this.darkMode=!1,this.loading=!0,this.selectedComment=null,this.subscriptions=[];const{user:d}=this.userCtx.requireUser();this.user=d,this.task=r.task}ngOnInit(){this.loadComments();const e=this.commentService.listenComments(this.task.id).subscribe(i=>{const o=this.comments$.getValue();o.find(s=>s.id===i.id)||(this.comments$.next([...o,i].sort((s,r)=>s.at-r.at)),this.scrollToBottom())}),n=this.socket.onTyping(this.task.id).subscribe(i=>{i!==this.user.uid&&(this.typingUser=i,clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>this.typingUser=null,2e3))});this.subscriptions.push(e,n)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadComments(){var e=this;return(0,c.A)(function*(){e.task&&(e.comments$.next(Array.isArray(e.task.comments)?[...e.task.comments].sort((n,i)=>n.at-i.at):[]),e.scrollToBottom()),e.loading=!1})()}addComment(){var e=this;return(0,c.A)(function*(){const n=e.newComment.trim();if(!n)return;const i=Date.now();let o;if(o=e.selectedComment?{...e.selectedComment,msg:n,updatedAt:i,updatedBy:e.user.uid}:{id:`${i}-${e.user.uid}`,msg:n,by:e.user.uid,at:i},e.task){if(Array.isArray(e.task.comments)||(e.task.comments=[]),e.selectedComment){const r=e.task.comments.findIndex(d=>d.id===e.selectedComment?.id);-1!==r&&(e.task.comments[r]=o)}else e.task.comments.push(o);(yield e.taskService.update(e.task))&&(e.newComment="",e.selectedComment=null,e.comments$.next(e.task.comments),e.scrollToBottom())}})()}saveEdit(e){e.msg.trim()&&this.setComment(e,e.msg)}cancelEdit(e){const n=this.comments$.getValue();this.comments$.next(n.map(i=>i.id===e.id?{...i,editing:!1}:i))}setComment(e,n){var i=this;return(0,c.A)(function*(){const o=n.trim();if(!o||!i.task)return;const s=Date.now(),r={...e,msg:o,updatedBy:i.user.uid,updatedAt:s},d=i.task.comments||[],u=d.findIndex(p=>p.id===e.id);if(-1!==u&&(d[u].msg=o,d[u].updatedAt=s,d[u].updatedBy=i.user.uid,i.task.comments=d,yield i.taskService.update(i.task))){const p=i.comments$.getValue().map(g=>g.id===e.id?{...r,editing:!1}:g);i.comments$.next(p)}})()}editComment(e){var n=this;return(0,c.A)(function*(){n.selectedComment=e,n.newComment=e.msg})()}cancelSelected(){var e=this;return(0,c.A)(function*(){e.selectedComment=null,e.newComment=""})()}deleteComment(e){var n=this;return(0,c.A)(function*(){if(!n.task||!Array.isArray(n.task.comments)||!confirm("\xcates-vous s\xfbr de vouloir supprimer d\xe9finitivement ce commentaire ?\nCette action est irr\xe9versible."))return;const o=n.task.comments.filter(r=>r.id!==e.id);n.task.comments=o,(yield n.taskService.update(n.task))&&(n.comments$.next(o),n.commentService.emitCommentDelete(n.task.id,e))})()}addReaction(e,n){var i=this;return(0,c.A)(function*(){if(!i.task||!Array.isArray(i.task.comments))return;const o=i.task.comments.map(r=>{if(r.id===e.id){const d=Array.from(new Set([...r.reactions||[],n]));return{...r,reactions:d}}return r});i.task.comments=o,(yield i.taskService.update(i.task))&&(i.comments$.next(o),i.commentService.emitCommentUpdate(i.task.id,{...e,reactions:e.reactions?[...e.reactions,n]:[n]}))})()}onTyping(){this.socket.emitTyping(this.task.id,this.user.uid)}trackById(e,n){return n.id}scrollToBottom(){setTimeout(()=>{this.scrollContainer&&this.scrollContainer.nativeElement.scrollTo({top:this.scrollContainer.nativeElement.scrollHeight,behavior:"smooth"})},100)}toggleDarkMode(){this.darkMode=!this.darkMode}close(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(I.L),t.rXU(Kt),t.rXU(j),t.rXU(x.i),t.rXU(O),t.rXU(P))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-comments-modal"]],viewQuery:function(n,i){if(1&n&&t.GBs(Jt,5),2&n){let o;t.mGM(o=t.lsd())&&(i.scrollContainer=o.first)}},standalone:!1,decls:21,vars:12,consts:[["scrollMe",""],["initials",""],[1,"modal-backdrop",3,"click"],[1,"modal"],[1,"modal-header"],[1,"header-actions"],[1,"mode-toggle",3,"click"],[1,"fa",3,"ngClass"],[1,"close-btn",3,"click"],[1,"chat-container"],["class","loading",4,"ngIf"],["class","chat-message",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","typing-indicator",4,"ngIf"],[1,"add-comment"],["type","text","placeholder","\xc9crire un message...",3,"ngModelChange","keydown","keydown.enter","ngModel"],["style","background-color: brown; margin-right: 10px;",3,"click",4,"ngIf"],[3,"click"],[1,"fa","fa-paper-plane"],[1,"loading"],[1,"chat-message",3,"ngClass"],[1,"message-content"],[1,"message-ctx"],[1,"avatar"],[3,"src",4,"ngIf","ngIfElse"],[1,"message-bubble"],[1,"text"],[1,"message-meta"],[1,"msg-hours"],[1,"author"],[1,"time"],["class","seen",4,"ngIf"],["class","reactions",4,"ngIf"],[1,"message-actions"],["title","\xc9diter",3,"click"],[1,"fa","fa-edit"],["title","Supprimer",3,"click"],[1,"fa","fa-trash"],[3,"src"],[1,"seen"],[1,"reactions"],[4,"ngFor","ngForOf"],[1,"typing-indicator"],[2,"background-color","brown","margin-right","10px",3,"click"]],template:function(n,i){if(1&n){const o=t.RV6();t.j41(0,"div",2),t.bIt("click",function(){return t.eBV(o),t.Njj(i.close())}),t.k0s(),t.j41(1,"div",3)(2,"div",4)(3,"h3"),t.EFF(4),t.k0s(),t.j41(5,"div",5)(6,"button",6),t.bIt("click",function(){return t.eBV(o),t.Njj(i.toggleDarkMode())}),t.nrm(7,"i",7),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){return t.eBV(o),t.Njj(i.close())}),t.EFF(9,"\xd7"),t.k0s()()(),t.j41(10,"div",9,0),t.DNE(12,Zt,2,0,"div",10)(13,ae,31,17,"div",11),t.nI1(14,"async"),t.k0s(),t.DNE(15,se,2,1,"div",12),t.j41(16,"div",13)(17,"input",14),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.newComment,r)||(i.newComment=r),t.Njj(r)}),t.bIt("keydown",function(){return t.eBV(o),t.Njj(i.onTyping())})("keydown.enter",function(){return t.eBV(o),t.Njj(i.addComment())}),t.k0s(),t.DNE(18,re,2,0,"button",15),t.j41(19,"button",16),t.bIt("click",function(){return t.eBV(o),t.Njj(i.addComment())}),t.nrm(20,"i",17),t.k0s()()()}2&n&&(t.R7$(),t.AVh("dark-mode",i.darkMode),t.R7$(3),t.JRh(i.task.title),t.R7$(3),t.Y8G("ngClass",i.darkMode?"fa-sun":"fa-moon"),t.R7$(5),t.Y8G("ngIf",i.loading),t.R7$(),t.Y8G("ngForOf",t.bMT(14,10,i.comments$))("ngForTrackBy",i.trackById),t.R7$(2),t.Y8G("ngIf",i.typingUser&&i.typingUser!==i.user.uid),t.R7$(2),t.R50("ngModel",i.newComment),t.R7$(),t.Y8G("ngIf",i.selectedComment))},dependencies:[m.YU,m.Sq,m.bT,_.me,_.BC,_.vS,m.Jj,m.Pc,m.P9,m.vh],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;backdrop-filter:blur(4px);z-index:99}.modal[_ngcontent-%COMP%]{position:fixed;inset:0;margin:auto;max-width:600px;height:90vh;background:#fff;display:flex;flex-direction:column;border-radius:20px;box-shadow:0 12px 40px #00000040;overflow:hidden;animation:_ngcontent-%COMP%_slideUp .35s ease;z-index:100;transition:background .3s ease,color .3s ease}.modal.dark-mode[_ngcontent-%COMP%]{background:#121212;color:#f1f1f1}.modal.dark-mode[_ngcontent-%COMP%]   .chat-message.incoming[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:#2a2a2a}.modal.dark-mode[_ngcontent-%COMP%]   .chat-message.outgoing[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:#056162;color:#fff}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid #e0e0e0;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;font-size:18px;cursor:pointer;transition:transform .2s}.header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.2)}.chat-container[_ngcontent-%COMP%]{flex:1;padding:14px;overflow-y:auto;scroll-behavior:smooth;background:#fafafa}.modal.dark-mode[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{background:#181818}.chat-message[_ngcontent-%COMP%]{display:flex;margin-bottom:14px;animation:_ngcontent-%COMP%_fadeIn .25s ease-in}.chat-message.incoming[_ngcontent-%COMP%]{flex-direction:row}.chat-message.outgoing[_ngcontent-%COMP%]{flex-direction:row-reverse}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .avatar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ddd;font-weight:700;color:#555;font-size:12px}.message-ctx[_ngcontent-%COMP%]{display:flex;flex-direction:row}.message-bubble[_ngcontent-%COMP%]{padding:2px 6px;border-radius:8px;max-width:75%;font-size:12px;line-height:1.4;box-shadow:0 2px 6px #00000026;word-wrap:break-word}.message-bubble[_ngcontent-%COMP%]:hover{transform:scale(1.03)}.chat-message.incoming[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:#f1f1f1;border-radius:8px 8px 8px 0}.chat-message.outgoing[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:#dcf8c6;border-radius:8px 8px 0}.message-meta[_ngcontent-%COMP%]{font-size:8px;color:#888;display:flex;justify-content:end;margin-top:2px}.message-meta[_ngcontent-%COMP%]   .msg-hours[_ngcontent-%COMP%]{margin-right:10px}.message-meta[_ngcontent-%COMP%]   .seen[_ngcontent-%COMP%]{color:#2196f3}.typing-indicator[_ngcontent-%COMP%]{font-size:12px;font-style:italic;color:#999;padding:6px 14px}.add-comment[_ngcontent-%COMP%]{display:flex;padding:10px 12px;border-top:1px solid #ddd;background:#fff}.modal.dark-mode[_ngcontent-%COMP%]   .add-comment[_ngcontent-%COMP%]{background:#1f1f1f;border-color:#333}.add-comment[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 14px;border-radius:25px;border:1px solid #ccc;outline:none;font-size:14px;transition:border .2s,background .2s}.add-comment[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#4caf50;background:#f9f9f9}.modal.dark-mode[_ngcontent-%COMP%]   .add-comment[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;border:1px solid #444}.add-comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#4caf50;border:none;border-radius:50%;margin-left:8px;width:44px;height:44px;color:#fff;font-size:18px;cursor:pointer;transition:background .25s,transform .2s}.add-comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#388e3c;transform:scale(1.1)}.message-actions[_ngcontent-%COMP%]{position:relative;top:-10px;right:6px;display:flex;gap:4px;opacity:0;transition:opacity .2s ease}.chat-message[_ngcontent-%COMP%]:hover   .message-actions[_ngcontent-%COMP%]{opacity:1}.message-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#fff;border:none;border-radius:50%;margin:0;padding:0;width:18px;height:18px;font-size:10px;cursor:pointer;box-shadow:0 1px 3px #0003;transition:background .2s,transform .2s}.message-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f0f0f0;transform:scale(1.1)}.reactions[_ngcontent-%COMP%]{position:relative;top:-10px;margin-top:0;display:flex;gap:4px;font-size:10px}.reactions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;transition:transform .2s ease}.reactions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.3)}.chat-footer[_ngcontent-%COMP%]{display:flex;padding:10px 12px;border-top:1px solid #ddd;background:#f0f0f0}.chat-footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:10px 14px;border-radius:25px;border:1px solid #ccc;outline:none;font-size:14px;transition:border .2s}.chat-footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#4caf50}.chat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#128c7e;border:none;border-radius:50%;margin-left:8px;width:44px;height:44px;color:#fff;font-size:18px;cursor:pointer;transition:background .2s,transform .2s}.chat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#075e54;transform:scale(1.1)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}"],data:{animation:[(0,C.hZ)("fadeIn",[(0,C.kY)(":enter",[(0,C.iF)({opacity:0,transform:"translateY(10px)"}),(0,C.i0)("200ms ease-out",(0,C.iF)({opacity:1,transform:"translateY(0)"}))])]),(0,C.hZ)("bubbleAnim",[(0,C.kY)(":enter",[(0,C.iF)({transform:"scale(0.9)"}),(0,C.i0)("150ms ease-out",(0,C.iF)({transform:"scale(1)"}))])])]}})}}return a})();function de(a,l){if(1&a&&(t.j41(0,"div",42),t.nrm(1,"div",43),t.j41(2,"span"),t.EFF(3),t.k0s()()),2&a){const e=t.XpG().$implicit,n=t.XpG(2);t.xc7("background",n.withOpacity(e.color,.1))("transform","none"),t.R7$(),t.xc7("background",e.color),t.R7$(),t.xc7("color",e.color),t.R7$(),t.JRh(e.name)}}function ce(a,l){if(1&a&&(t.qex(0),t.DNE(1,de,4,9,"div",41),t.bVm()),2&a){const e=l.$implicit,n=t.XpG(2);t.R7$(),t.Y8G("ngIf",(null==n.task.tag?null:n.task.tag.id)===e.id)}}function pe(a,l){if(1&a&&(t.j41(0,"div",44),t.EFF(1),t.k0s()),2&a){const e=l.$implicit,n=t.XpG(2);t.xc7("background",e.color),t.Y8G("title",e.displayName||e.email),t.R7$(),t.SpI(" ",n.getInitials(e.displayName||e.email)," ")}}function ge(a,l){if(1&a&&(t.j41(0,"div",46),t.nrm(1,"div",43),t.EFF(2),t.k0s()),2&a){const e=t.XpG().$implicit;t.xc7("background",e.big.bg)("color",e.big.color)("transform","none"),t.Y8G("title",e.name),t.BMQ("data-priority",e.id),t.R7$(),t.xc7("background",e.small.bg),t.R7$(),t.SpI(" ",e.label||"Low"," ")}}function fe(a,l){if(1&a&&(t.qex(0),t.DNE(1,ge,3,11,"div",45),t.bVm()),2&a){const e=l.$implicit,n=t.XpG(2);t.R7$(),t.Y8G("ngIf",(null==n.task.priority?null:n.task.priority.id)==e.id)}}function ue(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",47)(1,"input",48),t.mxI("ngModelChange",function(i){const o=t.eBV(e).$implicit;return t.DH7(o.done,i)||(o.done=i),t.Njj(i)}),t.k0s(),t.j41(2,"input",49),t.mxI("ngModelChange",function(i){const o=t.eBV(e).$implicit;return t.DH7(o.name,i)||(o.name=i),t.Njj(i)}),t.k0s()()}if(2&a){const e=l.$implicit;t.BMQ("data-id",e.id),t.R7$(),t.R50("ngModel",e.done),t.Y8G("disabled",!0)("readOnly",!0),t.R7$(),t.R50("ngModel",e.name),t.Y8G("disabled",!0)("readOnly",!0)}}function me(a,l){if(1&a&&(t.qex(0),t.nrm(1,"img",56),t.bVm()),2&a){const e=t.XpG().$implicit;t.R7$(),t.Y8G("src",e.url,t.B4B)}}function _e(a,l){1&a&&t.nrm(0,"i",57)}function he(a,l){if(1&a&&(t.j41(0,"div",50)(1,"div",51),t.DNE(2,me,2,1,"ng-container",52)(3,_e,1,0,"ng-template",null,0,t.C5r),t.k0s(),t.j41(5,"div",53)(6,"div",54),t.EFF(7),t.k0s(),t.j41(8,"div",55),t.EFF(9),t.nI1(10,"number"),t.k0s()()()),2&a){const e=l.$implicit,n=t.sdS(4);t.BMQ("data-id",e.id),t.R7$(2),t.Y8G("ngIf",e.url)("ngIfElse",n),t.R7$(5),t.JRh(e.name),t.R7$(2),t.SpI("",t.i5U(10,5,e.size/1024,"1.0-0")," KB")}}function be(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),t.nrm(4,"i",7),t.j41(5,"span",8),t.EFF(6),t.k0s()()(),t.j41(7,"div",9)(8,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeModal())}),t.nrm(9,"i",11),t.k0s()()(),t.j41(10,"div",12)(11,"div",13)(12,"div",14)(13,"label",15)(14,"div",16),t.nrm(15,"i",17),t.EFF(16," Titre de la t\xe2che "),t.k0s()(),t.j41(17,"label",18)(18,"input",19),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.task.title,i)||(o.task.title=i),t.Njj(i)}),t.k0s()()(),t.j41(19,"div",20)(20,"label",21)(21,"div",22),t.nrm(22,"i",23),t.EFF(23," Description"),t.k0s()(),t.j41(24,"label",24)(25,"textarea",25),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.task.description,i)||(o.task.description=i),t.Njj(i)}),t.k0s()()(),t.j41(26,"div",26)(27,"div",20)(28,"div",27)(29,"div",22),t.EFF(30,"\xc9tiquette"),t.k0s()(),t.j41(31,"div",28),t.DNE(32,ce,2,1,"ng-container",29),t.k0s()(),t.j41(33,"div",20)(34,"div",27)(35,"div",22),t.EFF(36,"Assigner"),t.k0s()(),t.j41(37,"div",30)(38,"div",31),t.DNE(39,pe,2,4,"div",32),t.k0s()()()(),t.j41(40,"div",26)(41,"div",20)(42,"div",27)(43,"div",22),t.EFF(44,"Date limite"),t.k0s()(),t.j41(45,"div",33),t.nrm(46,"i",34),t.j41(47,"input",35),t.mxI("ngModelChange",function(i){t.eBV(e);const o=t.XpG();return t.DH7(o.task.due,i)||(o.task.due=i),t.Njj(i)}),t.k0s()()(),t.j41(48,"div",20)(49,"div",27)(50,"div",22),t.EFF(51,"Priorit\xe9"),t.k0s()(),t.j41(52,"div",36),t.DNE(53,fe,2,1,"ng-container",29),t.k0s()()(),t.j41(54,"div",20)(55,"div",27)(56,"div",22),t.EFF(57,"Checklist"),t.k0s()(),t.j41(58,"div",37),t.DNE(59,ue,3,7,"div",38),t.k0s()(),t.j41(60,"div",20)(61,"div",27)(62,"div",22),t.EFF(63,"Pi\xe8ces jointes"),t.k0s()(),t.j41(64,"div",39),t.DNE(65,he,11,8,"div",40),t.k0s()()()()()}if(2&a){const e=t.XpG();t.R7$(6),t.JRh(e.task.title?e.task.title:"Visualisation"),t.R7$(11),t.AVh("filled",e.task.title.trim()),t.R7$(),t.R50("ngModel",e.task.title),t.Y8G("disabled",!0)("readOnly",!0),t.R7$(6),t.AVh("filled",e.task.description.trim()),t.R7$(),t.R50("ngModel",e.task.description),t.Y8G("disabled",!0)("readOnly",!0),t.R7$(7),t.Y8G("ngForOf",e.state.tags),t.R7$(7),t.Y8G("ngForOf",e.state.assignees),t.R7$(6),t.AVh("filled",e.task.due),t.R7$(2),t.R50("ngModel",e.task.due),t.Y8G("disabled",!0)("readOnly",!0),t.R7$(6),t.Y8G("ngForOf",e.state.prioritiesList),t.R7$(6),t.Y8G("ngForOf",e.state.checklist),t.R7$(6),t.Y8G("ngForOf",e.state.files)}}let ke=(()=>{class a{constructor(e,n,i,o,s){this.userCtx=e,this.taskProvider=n,this.userService=i,this.dialogRef=o,this.data=s,this.state={tags:[],assignees:[],checklist:[],files:[],assigneeQuery:"",newCheckText:"",priority:"",newTag:{name:"",color:"#ff7a7a"},usersList:[],prioritiesList:[]},this.initializeApp()}ngOnInit(){}initializeApp(){var e=this;return(0,c.A)(function*(){e.task=e.data.task;const{user:n}=e.userCtx.requireUser();e.state.usersList=yield e.userService.getUsers(),e.user=n,e.state.tags=[...e.taskProvider.tagsList],e.state.prioritiesList=e.taskProvider.prioritiesList,e.state.assignees=e.state.usersList.filter(i=>Object.keys(e.task.assignTo??{}).includes(i.uid)),e.state.checklist=e.task.checklist??[],e.state.files=Object.values(e.task.attachments).flatMap(i=>i.files)})()}ngOnDestroy(){this.state.files.forEach(e=>{if(e.url)try{URL.revokeObjectURL(e.url)}catch{}})}onBackdropClick(e){const n=e.target;n&&"backdrop"===n.id&&this.closeModal()}getInitials(e){return e?e.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():""}withOpacity(e,n){return 3===(e=e.replace("#","")).length&&(e=e.split("").map(o=>o+o).join("")),n=Math.max(0,Math.min(1,n)),`#${e}${Math.round(255*n).toString(16).padStart(2,"0")}`}closeModal(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(x.i),t.rXU(w),t.rXU(X),t.rXU(O),t.rXU(P))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-view-task-modal"]],inputs:{task:"task",user:"user"},standalone:!1,decls:2,vars:1,consts:[["fileIcon",""],["id","backdrop","role","dialog","aria-modal","true","aria-labelledby","modalTitle",1,"modal-backdrop",3,"click"],["class","modal","role","document","aria-describedby","modalDesc",4,"ngIf"],["role","document","aria-describedby","modalDesc",1,"modal"],[1,"modal-header"],[1,"title-wrap"],["id","modalTitle",1,"modal-title"],[1,"ri-task-line",2,"font-size","20px","color","var(--accent)"],["id","titleLabel"],[1,"header-controls"],["id","closeBtn","aria-label","Fermer",1,"btn-icon",3,"click"],[1,"ri-close-line"],[1,"modal-body"],["aria-hidden","false",1,"form-col"],["role","group","aria-labelledby","labelTitle",1,"input-card","focus"],["for","titleInput",1,"label-row"],["id","labelTitle",1,"label"],[1,"ri-edit-2-line","fi-icon"],["for","titleInput","data-field","title","id","fieldTitle",1,"field"],["id","titleInput","type","text","placeholder"," ","aria-required","true",3,"ngModelChange","ngModel","disabled","readOnly"],[1,"input-card","focus"],["for","descInput",1,"label-row"],[1,"label"],[1,"ri-file-text-line","fi-icon"],["for","descInput","data-field","desc","id","fieldDesc",1,"field"],["id","descInput","placeholder"," ",3,"ngModelChange","ngModel","disabled","readOnly"],[1,"row-2"],[1,"label-row"],["id","tagsList",1,"tag-picker"],[4,"ngFor","ngForOf"],[2,"display","flex","gap","8px","align-items","center"],["id","assigneeList",1,"assignees"],["class","avatar small",3,"title","background",4,"ngFor","ngForOf"],["id","fieldDue",1,"field"],[1,"ri-calendar-line","fi-icon"],["id","dueInput","type","date",3,"ngModelChange","ngModel","disabled","readOnly"],["id","prioritiesList",1,"tag-picker"],["id","checklist",1,"checklist"],["class","ck-item","draggable","true",4,"ngFor","ngForOf"],["id","filesPreview",2,"margin-top","10px","display","flex","flex-direction","column","gap","4px"],["class","file-preview",4,"ngFor","ngForOf"],["class","tag-chip",3,"background","transform",4,"ngIf"],[1,"tag-chip"],[1,"dot"],[1,"avatar","small",3,"title"],["class","tag-chip",3,"background","color","transform","title",4,"ngIf"],[1,"tag-chip",3,"title"],["draggable","true",1,"ck-item"],["type","checkbox","aria-label","Done",2,"zoom","1.5",3,"ngModelChange","ngModel","disabled","readOnly"],["type","text","placeholder","\xc9l\xe9ment",3,"ngModelChange","ngModel","disabled","readOnly"],[1,"file-preview"],[1,"file-thumb"],[4,"ngIf","ngIfElse"],[1,"file-meta"],[2,"font-weight","400","font-size","10px"],[1,"file-size","muted",2,"font-size","10px"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"src"],[1,"ri-file-line",2,"font-size","20px","color","#334155"]],template:function(n,i){1&n&&(t.j41(0,"div",1),t.bIt("click",function(s){return i.onBackdropClick(s)}),t.DNE(1,be,66,21,"div",2),t.k0s()),2&n&&(t.R7$(),t.Y8G("ngIf",i.task))},dependencies:[m.Sq,m.bT,_.me,_.Zm,_.BC,_.vS,m.QX],styles:["[_nghost-%COMP%]{--accent: #7c3aed;--accent-2: #6366f1;--bg: #f6f7fb;--card: rgba(255,255,255,.75);--glass-border: rgba(200,200,200,.18);--glass-shadow: 0 12px 34px rgba(18,25,40,.12);--radius-lg: 14px;--radius-md: 10px;--muted: #6b7280;--success: #10b981;--danger: #ef4444;--glass-blur: 10px;--transition: .22s cubic-bezier(.2,.9,.25,1);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}*[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[_nghost-%COMP%]{display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff9;backdrop-filter:blur(1px);z-index:1000;overflow-y:auto;overflow-x:hidden;animation:_ngcontent-%COMP%_backdropIn .26s var(--transition)}@keyframes _ngcontent-%COMP%_backdropIn{0%{opacity:0}to{opacity:1}}.modal[_ngcontent-%COMP%]{width:auto;max-width:50vh;max-height:90vh;border-radius:var(--radius-lg);background:linear-gradient(180deg,#fffffff2,#ffffffe6);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);backdrop-filter:blur(var(--glass-blur)) saturate(125%);overflow:hidden;display:flex;flex-direction:column;transform-origin:center;animation:_ngcontent-%COMP%_pop .26s var(--transition)}@keyframes _ngcontent-%COMP%_pop{0%{transform:translateY(10px) scale(.995);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 15px;border-bottom:1px solid rgba(15,23,42,.04);background:linear-gradient(90deg,#fff6,#fff3)}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.modal-title[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:700;color:#0b1220;display:flex;align-items:center;gap:10px}.pill-meta[_ngcontent-%COMP%]{font-size:.82rem;color:var(--muted);background:#6366f114;padding:6px 9px;border-radius:999px}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.btn-icon[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer;padding:8px;border-radius:8px;color:var(--muted);transition:all var(--transition);display:inline-flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]:hover{background:#0f172a0a;color:var(--accent);transform:translateY(-2px)}.modal-body[_ngcontent-%COMP%]{padding:18px;align-items:center;overflow-y:auto;overflow-x:hidden}.form-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.input-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);border-radius:12px;padding:4px;border:1px solid rgba(15,23,42,.03);transition:box-shadow var(--transition),transform var(--transition)}.input-card[_ngcontent-%COMP%]:focus-within{box-shadow:0 10px 30px #6366f112;transform:translateY(-2px)}.label-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.label-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--muted);font-weight:600}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.field[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;border:1px solid rgba(15,23,42,.04);background:#fff9}.field.focus[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 8px 20px #6366f117;transform:translateY(-2px)}.field[_ngcontent-%COMP%]   .fi-icon[_ngcontent-%COMP%]{color:#94a3b8;font-size:18px;margin-left:2px}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:.96rem;color:inherit;width:100%}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;padding-top:4px}.floating-label[_ngcontent-%COMP%]{position:absolute;top:10px;left:48px;font-size:.9rem;color:var(--muted);pointer-events:none;transform-origin:left top;transition:all var(--transition);background:linear-gradient(90deg,#fffffff2,#fffffff2);padding:0 6px;border-radius:6px}.field.filled[_ngcontent-%COMP%]   .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%]{transform:translateY(-22px) scale(.84);color:var(--accent)}.row-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.tag-picker[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap;font-size:12px}.tag-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 4px;border-radius:999px;background:linear-gradient(180deg,#ffffffb3,#ffffff80);border:1px solid rgba(15,23,42,.267);font-weight:600;cursor:pointer;transition:all var(--transition)}.tag-chip[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;box-shadow:0 2px 6px #0000000f}.tag-chip[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.tag-editor[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;margin-top:8px}.assignees[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:24px;font-size:11px;height:24px;border-radius:50%;display:inline-grid;place-items:center;font-weight:700;color:#fff;box-shadow:0 4px 12px #02061714;cursor:pointer}.avatar.small[_ngcontent-%COMP%]{width:18px;height:18px;font-size:8px}.avatar-list[_ngcontent-%COMP%]{display:flex;gap:2px;margin-top:6px;max-width:250px;overflow-x:scroll}.assignee-input[_ngcontent-%COMP%]{min-width:80px;padding:6px 10px;border-radius:12px;border:1px solid rgba(15,23,42,.397);background:#fff9}.assignee1[_ngcontent-%COMP%]{width:140px}.checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;margin-top:2px}.ck-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);padding:0 2px;border-radius:10px;border:1px solid rgba(15,23,42,.26);transition:all var(--transition);cursor:grab}.ck-item[dragging=true][_ngcontent-%COMP%]{opacity:.6;transform:scale(.995)}.ck-item[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem}.ck-controls[_ngcontent-%COMP%]{display:flex;gap:3px;align-items:center}.dropzone[_ngcontent-%COMP%]{border:2px dashed rgba(15,23,42,.06);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;min-height:54px;transition:all var(--transition);background:linear-gradient(180deg,#ffffffa6,#fff9)}.dropzone.dragover[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 10px 30px #6366f10f}.file-preview[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding:8px 10px;border-radius:10px;background:#fff9;border:1px solid rgba(15,23,42,.03)}.file-thumb[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:8px;background:#eef2ff;display:grid;place-items:center;font-weight:500}.file-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#0b1220}.remove-file[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--danger);cursor:pointer}.file-size[_ngcontent-%COMP%]{font-size:.78rem;color:#64748b}.meta-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;position:relative}.card[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffffb3,#fff9);border:1px solid rgba(15,23,42,.03)}.preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-start}.meta-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px;align-items:center}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding:14px 18px;border-top:1px solid rgba(15,23,42,.04);flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;border:none;box-shadow:0 6px 18px #0206170a;transition:all var(--transition)}.btn.secondary[_ngcontent-%COMP%]{background:#f8fafc;color:#0b1220}.btn.primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 12px 30px #7c3aed2e}.btn.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(15,23,42,.04)}.muted[_ngcontent-%COMP%]{color:var(--muted);font-size:.85rem}.small[_ngcontent-%COMP%]{font-size:.82rem}.flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}@media (max-width: 980px){.modal[_ngcontent-%COMP%]{width:100%;max-width:95vw;max-height:95vh}.modal-body[_ngcontent-%COMP%]{grid-template-columns:1fr}.meta-col[_ngcontent-%COMP%]{order:2;width:100%}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.tag-picker[_ngcontent-%COMP%], .assignees[_ngcontent-%COMP%], .ck-item[_ngcontent-%COMP%]{flex-wrap:wrap;width:100%}.dropzone[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();const xe=["fileInput"];function Ce(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",24),t.bIt("dragstart",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onCheckDragStart(i,o.id))})("dragend",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCheckDragEnd())})("dragover",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onCheckDragOver(i,o.id))}),t.j41(1,"input",25),t.bIt("change",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onDoneChange(i,o))}),t.k0s(),t.j41(2,"input",26),t.mxI("ngModelChange",function(i){const o=t.eBV(e).$implicit;return t.DH7(o.name,i)||(o.name=i),t.Njj(i)}),t.k0s(),t.j41(3,"div",27)(4,"button",28),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.duplicateCheckItem(i.id))}),t.EFF(5," Cloner "),t.k0s(),t.j41(6,"button",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeCheckItem(i.id))}),t.EFF(7," x "),t.k0s()()()}if(2&a){const e=l.$implicit;t.BMQ("data-id",e.id),t.R7$(),t.Y8G("checked",null==e.done?null:e.done.ok),t.R7$(),t.R50("ngModel",e.name)}}let ve=(()=>{class a{constructor(e,n,i,o){this.userCtx=e,this.taskService=n,this.dialogRef=i,this.data=o,this.save=new t.bkB,this.close=new t.bkB,this.draggingId=null,this.state={checklist:[],newCheckText:""},this.isEdited=!1;const{user:s}=this.userCtx.requireUser();this.user=s,this.task=o.task}handleKeydown(e){"Escape"===e.key&&this.closeModal(),(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.saveTask())}ngOnInit(){this.initializeApp()}initializeApp(){this.state.checklist=this.task.checklist??[]}ngOnDestroy(){}onBackdropClick(e){}getInitials(e){return e?e.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():""}withOpacity(e,n){return 3===(e=e.replace("#","")).length&&(e=e.split("").map(o=>o+o).join("")),n=Math.max(0,Math.min(1,n)),`#${e}${Math.round(255*n).toString(16).padStart(2,"0")}`}uid(e="id"){return e+Math.random().toString(36).slice(2,9)}onDoneChange(e,n){const i=e.target.checked;n.done={ok:i,by:i?this.user.uid??"Unknown User":"",at:i?Date.now():0},this.isEdited=!0}addCheckItem(){const e=this.state.newCheckText.trim();if(!e)return;const n=this.user.uid??"Unknown User",i={id:this.uid("ck"),name:e,created:{by:n,at:Date.now()}};this.state.checklist.push(i),this.state.newCheckText="",this.isEdited=!0}removeCheckItem(e){this.state.checklist=this.state.checklist.filter(n=>n.id!==e),this.isEdited=!0}duplicateCheckItem(e){const n=this.state.checklist.find(r=>r.id===e);if(!n)return;const i=this.user.uid??"Unknown User",o={id:this.uid("ck"),name:n.name,done:{ok:!1,by:"",at:0},created:{by:i,at:Date.now()}},s=this.state.checklist.findIndex(r=>r.id===e);this.state.checklist.splice(s+1,0,o),this.isEdited=!0}onCheckDragStart(e,n){this.draggingId=n,e.dataTransfer?.setData("text/plain",n),setTimeout(()=>{},10)}onCheckDragEnd(){this.draggingId=null,this.isEdited=!0}onCheckDragOver(e,n){if(e.preventDefault(),!this.draggingId||this.draggingId===n)return;const i=this.state.checklist.findIndex(r=>r.id===this.draggingId),o=this.state.checklist.findIndex(r=>r.id===n);if(-1===i||-1===o)return;const[s]=this.state.checklist.splice(i,1);this.state.checklist.splice(o,0,s)}saveTask(){var e=this;return(0,c.A)(function*(){e.state.checklist&&e.state.checklist.length>0&&(e.task.checklist=e.state.checklist.flatMap(i=>({id:i.id,name:i.name,done:i.done,created:i.created,updated:i.updated}))),(yield e.taskService.update(e.task))&&(e.isEdited=!1,e.closeModal())})()}closeModal(){let e=!1;this.isEdited&&(e=confirm("Vous n'avez pas sauvegard\xe9 vos modifications.\nSi vous continuez, les changements non enregistr\xe9s seront perdus. Voulez-vous vraiment poursuivre ?")),(!this.isEdited||e)&&this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(x.i),t.rXU(j),t.rXU(O),t.rXU(P))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-task-check-list-modal"]],viewQuery:function(n,i){if(1&n&&t.GBs(xe,5),2&n){let o;t.mGM(o=t.lsd())&&(i.fileInputRef=o.first)}},hostBindings:function(n,i){1&n&&t.bIt("keydown",function(s){return i.handleKeydown(s)},!1,t.tSv)},inputs:{task:"task"},outputs:{save:"save",close:"close"},standalone:!1,decls:30,vars:3,consts:[["id","backdrop","role","dialog","aria-modal","true","aria-labelledby","modalTitle",1,"modal-backdrop",3,"click"],["role","document","aria-describedby","modalDesc",1,"modal"],[1,"modal-header"],[1,"title-wrap"],["id","modalTitle",1,"modal-title"],[1,"ri-task-line",2,"font-size","20px","color","var(--accent)"],["id","titleLabel"],[1,"header-controls"],["id","closeBtn","aria-label","Fermer",1,"btn-icon",3,"click"],[1,"ri-close-line"],[1,"modal-body"],["aria-hidden","false",1,"form-col"],[1,"input-card","focus"],[1,"label-row"],[1,"label"],[1,"hint","small","muted"],["id","checklist",1,"checklist"],["class","ck-item","draggable","true",3,"dragstart","dragend","dragover",4,"ngFor","ngForOf"],[2,"display","flex","gap","4px","margin-top","10px"],["id","newCheckInput","placeholder","Nouvel \xe9l\xe9ment de checklist...",1,"assignee-input","assignee3",3,"ngModelChange","keydown.enter","ngModel"],["id","addCheckBtn",1,"btn","ghost",3,"click"],[1,"modal-actions"],["id","cancelBtn",1,"btn","secondary",3,"click"],["id","saveBtn",1,"btn","primary",3,"click"],["draggable","true",1,"ck-item",3,"dragstart","dragend","dragover"],["type","checkbox","aria-label","Done",2,"zoom","1.5",3,"change","checked"],["type","text","placeholder","\xc9l\xe9ment",3,"ngModelChange","ngModel"],[1,"ck-controls"],["title","Dupliquer",1,"btn","ghost","small",2,"padding","4px",3,"click"],["title","Supprimer",1,"btn","ghost","small",2,"padding","4px","color","red",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"div",0),t.bIt("click",function(s){return i.onBackdropClick(s)}),t.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.nrm(5,"i",5),t.j41(6,"span",6),t.EFF(7),t.k0s()()(),t.j41(8,"div",7)(9,"button",8),t.bIt("click",function(){return i.closeModal()}),t.nrm(10,"i",9),t.k0s()()(),t.j41(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",13)(15,"div",14),t.EFF(16,"Checklist"),t.k0s(),t.j41(17,"div",15),t.EFF(18,"Drag pour r\xe9ordonner"),t.k0s()(),t.j41(19,"div",16),t.DNE(20,Ce,8,3,"div",17),t.k0s(),t.j41(21,"div",18)(22,"input",19),t.mxI("ngModelChange",function(s){return t.DH7(i.state.newCheckText,s)||(i.state.newCheckText=s),s}),t.bIt("keydown.enter",function(){return i.addCheckItem()}),t.k0s(),t.j41(23,"button",20),t.bIt("click",function(){return i.addCheckItem()}),t.EFF(24,"Ajouter"),t.k0s()()()()(),t.j41(25,"div",21)(26,"button",22),t.bIt("click",function(){return i.closeModal()}),t.EFF(27,"Annuler"),t.k0s(),t.j41(28,"button",23),t.bIt("click",function(){return i.saveTask()}),t.EFF(29,"Enregistrer"),t.k0s()()()()),2&n&&(t.R7$(7),t.JRh(i.task.title?"Modifier la t\xe2che":"Nouvelle t\xe2che"),t.R7$(13),t.Y8G("ngForOf",i.state.checklist),t.R7$(2),t.R50("ngModel",i.state.newCheckText))},dependencies:[m.Sq,_.me,_.BC,_.vS],styles:["[_nghost-%COMP%]{--accent: #7c3aed;--accent-2: #6366f1;--bg: #f6f7fb;--card: rgba(255,255,255,.75);--glass-border: rgba(200,200,200,.18);--glass-shadow: 0 12px 34px rgba(18,25,40,.12);--radius-lg: 14px;--radius-md: 10px;--muted: #6b7280;--success: #10b981;--danger: #ef4444;--glass-blur: 10px;--transition: .22s cubic-bezier(.2,.9,.25,1);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}*[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[_nghost-%COMP%]{display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff9;backdrop-filter:blur(1px);z-index:1000;overflow-y:auto;overflow-x:hidden;animation:_ngcontent-%COMP%_backdropIn .26s var(--transition)}@keyframes _ngcontent-%COMP%_backdropIn{0%{opacity:0}to{opacity:1}}.modal[_ngcontent-%COMP%]{width:auto;max-width:50vh;max-height:90vh;border-radius:var(--radius-lg);background:linear-gradient(180deg,#fffffff2,#ffffffe6);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);backdrop-filter:blur(var(--glass-blur)) saturate(125%);overflow:hidden;display:flex;flex-direction:column;transform-origin:center;animation:_ngcontent-%COMP%_pop .26s var(--transition)}@keyframes _ngcontent-%COMP%_pop{0%{transform:translateY(10px) scale(.995);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 15px;border-bottom:1px solid rgba(15,23,42,.04);background:linear-gradient(90deg,#fff6,#fff3)}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.modal-title[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:700;color:#0b1220;display:flex;align-items:center;gap:10px}.pill-meta[_ngcontent-%COMP%]{font-size:.82rem;color:var(--muted);background:#6366f114;padding:6px 9px;border-radius:999px}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.btn-icon[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer;padding:8px;border-radius:8px;color:var(--muted);transition:all var(--transition);display:inline-flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]:hover{background:#0f172a0a;color:var(--accent);transform:translateY(-2px)}.modal-body[_ngcontent-%COMP%]{padding:18px;align-items:center;overflow-y:auto;overflow-x:hidden}.form-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.input-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);border-radius:12px;padding:4px;border:1px solid rgba(15,23,42,.03);transition:box-shadow var(--transition),transform var(--transition)}.input-card[_ngcontent-%COMP%]:focus-within{box-shadow:0 10px 30px #6366f112;transform:translateY(-2px)}.label-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.label-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--muted);font-weight:600}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.field[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;border:1px solid rgba(15,23,42,.04);background:#fff9}.field.focus[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 8px 20px #6366f117;transform:translateY(-2px)}.field[_ngcontent-%COMP%]   .fi-icon[_ngcontent-%COMP%]{color:#94a3b8;font-size:18px;margin-left:2px}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:.96rem;color:inherit;width:100%}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;padding-top:4px}.floating-label[_ngcontent-%COMP%]{position:absolute;top:10px;left:48px;font-size:.9rem;color:var(--muted);pointer-events:none;transform-origin:left top;transition:all var(--transition);background:linear-gradient(90deg,#fffffff2,#fffffff2);padding:0 6px;border-radius:6px}.field.filled[_ngcontent-%COMP%]   .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%]{transform:translateY(-22px) scale(.84);color:var(--accent)}.row-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.tag-picker[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap;font-size:12px}.tag-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 4px;border-radius:999px;background:linear-gradient(180deg,#ffffffb3,#ffffff80);border:1px solid rgba(15,23,42,.267);font-weight:600;cursor:pointer;transition:all var(--transition)}.tag-chip[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;box-shadow:0 2px 6px #0000000f}.tag-chip[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.tag-editor[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;margin-top:8px}.assignees[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:24px;font-size:11px;height:24px;border-radius:50%;display:inline-grid;place-items:center;font-weight:700;color:#fff;box-shadow:0 4px 12px #02061714;cursor:pointer}.avatar.small[_ngcontent-%COMP%]{width:18px;height:18px;font-size:8px}.avatar-list[_ngcontent-%COMP%]{display:flex;gap:2px;margin-top:6px;max-width:250px;overflow-x:scroll}.assignee-input[_ngcontent-%COMP%]{min-width:80px;padding:6px 10px;border-radius:12px;border:1px solid rgba(15,23,42,.397);background:#fff9}.assignee1[_ngcontent-%COMP%]{width:140px}.checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;margin-top:2px}.ck-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);padding:0 2px;border-radius:10px;border:1px solid rgba(15,23,42,.26);transition:all var(--transition);cursor:grab}.ck-item[dragging=true][_ngcontent-%COMP%]{opacity:.6;transform:scale(.995)}.ck-item[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem}.ck-controls[_ngcontent-%COMP%]{display:flex;gap:3px;align-items:center}.dropzone[_ngcontent-%COMP%]{border:2px dashed rgba(15,23,42,.06);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;min-height:54px;transition:all var(--transition);background:linear-gradient(180deg,#ffffffa6,#fff9)}.dropzone.dragover[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 10px 30px #6366f10f}.file-preview[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding:8px 10px;border-radius:10px;background:#fff9;border:1px solid rgba(15,23,42,.03)}.file-thumb[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:8px;background:#eef2ff;display:grid;place-items:center;font-weight:700}.file-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#0b1220}.remove-file[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--danger);cursor:pointer}.file-size[_ngcontent-%COMP%]{font-size:.78rem;color:#64748b}.meta-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;position:relative}.card[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffffb3,#fff9);border:1px solid rgba(15,23,42,.03)}.preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-start}.meta-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px;align-items:center}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding:14px 18px;border-top:1px solid rgba(15,23,42,.04);flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;border:none;box-shadow:0 6px 18px #0206170a;transition:all var(--transition)}.btn.secondary[_ngcontent-%COMP%]{background:#f8fafc;color:#0b1220}.btn.primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 12px 30px #7c3aed2e}.btn.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(15,23,42,.04)}.muted[_ngcontent-%COMP%]{color:var(--muted);font-size:.85rem}.small[_ngcontent-%COMP%]{font-size:.82rem}.flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}@media (max-width: 980px){.modal[_ngcontent-%COMP%]{width:100%;max-width:95vw;max-height:95vh}.modal-body[_ngcontent-%COMP%]{grid-template-columns:1fr}.meta-col[_ngcontent-%COMP%]{order:2;width:100%}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.tag-picker[_ngcontent-%COMP%], .assignees[_ngcontent-%COMP%], .ck-item[_ngcontent-%COMP%]{flex-wrap:wrap;width:100%}.dropzone[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0})}}return a})();const ye=["fileInput"];function Me(a,l){if(1&a&&(t.qex(0),t.nrm(1,"img",33),t.bVm()),2&a){const e=t.XpG().$implicit;t.R7$(),t.Y8G("src",e.url,t.B4B)}}function Oe(a,l){1&a&&t.nrm(0,"i",34)}function Te(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",25)(1,"div",26),t.DNE(2,Me,2,1,"ng-container",27)(3,Oe,1,0,"ng-template",null,1,t.C5r),t.k0s(),t.j41(5,"div",28)(6,"div",29),t.EFF(7),t.k0s(),t.j41(8,"div",30),t.EFF(9),t.nI1(10,"number"),t.k0s()(),t.j41(11,"div",31)(12,"button",32),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeFile(i.id))}),t.nrm(13,"i",11),t.k0s()()()}if(2&a){const e=l.$implicit,n=t.sdS(4);t.BMQ("data-id",e.id),t.R7$(2),t.Y8G("ngIf",e.url)("ngIfElse",n),t.R7$(5),t.JRh(e.name),t.R7$(2),t.SpI("",t.i5U(10,5,e.size/1024,"1.0-0")," KB")}}let Pe=(()=>{class a{constructor(e,n,i,o,s,r){this.el=e,this.taskService=n,this.provider=i,this.userCtx=o,this.dialogRef=s,this.data=r,this.isEdited=!1,this.files=[];const{user:d}=this.userCtx.requireUser();this.user=d,this.task=r.task}onPaste(e){const n=e.clipboardData?.files;n&&n.length&&this.handleFiles(Array.from(n))}handleKeydown(e){"Escape"===e.key&&this.closeModal(),(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.saveTask())}uid(e="id"){return e+Math.random().toString(36).slice(2,9)}ngOnInit(){this.files=Object.values(this.task.attachments).flatMap(e=>e.files)}ngOnDestroy(){this.files.forEach(e=>{if(e.url)try{URL.revokeObjectURL(e.url)}catch{}})}onBackdropClick(e){const n=e.target;n&&"backdrop"===n.id&&this.closeModal()}getInitials(e){return e?e.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():""}onFileInputChange(e){const n=e.target,i=n.files?Array.from(n.files):[];this.handleFiles(i),n.value=""}handleFiles(e){e.forEach(n=>{const o={id:this.uid("f"),file:n,url:"",name:n.name,size:n.size};n.type.startsWith("image/")&&(o.url=URL.createObjectURL(n)),this.files.push(o)})}removeFile(e){const n=this.files.findIndex(i=>i.id===e);if(n>-1){const i=this.files[n];if(i.url)try{URL.revokeObjectURL(i.url)}catch{}this.files.splice(n,1)}}onDropzoneDragOver(e){e.preventDefault()}onDropzoneDrop(e){e.preventDefault();const n=e.dataTransfer?.files?Array.from(e.dataTransfer.files):[];n.length&&this.handleFiles(n)}saveTask(){var e=this;return(0,c.A)(function*(){if(e.files.length>0){e.task.attachments||(e.task.attachments={});const i=e.files.map(o=>({id:o.id,name:o.name,url:o.url,file:o.file,size:o.size}));e.task.attachments[e.user.uid]={at:Date.now(),files:i}}(yield e.taskService.update(e.task))&&(e.isEdited=!1,e.closeModal())})()}closeModal(){let e=!1;this.isEdited&&(e=confirm("Vous n'avez pas sauvegard\xe9 vos modifications.\nSi vous continuez, les changements non enregistr\xe9s seront perdus. Voulez-vous vraiment poursuivre ?")),(!this.isEdited||e)&&this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(t.aKT),t.rXU(j),t.rXU(w),t.rXU(x.i),t.rXU(O),t.rXU(P))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-task-files-modal"]],viewQuery:function(n,i){if(1&n&&t.GBs(ye,5),2&n){let o;t.mGM(o=t.lsd())&&(i.fileInputRef=o.first)}},hostBindings:function(n,i){1&n&&t.bIt("paste",function(s){return i.onPaste(s)},!1,t.tSv)("keydown",function(s){return i.handleKeydown(s)},!1,t.tSv)},standalone:!1,decls:29,vars:2,consts:[["fileInput",""],["fileIcon",""],["id","backdrop","role","dialog","aria-modal","true","aria-labelledby","modalTitle",1,"modal-backdrop",3,"click"],["role","document","aria-describedby","modalDesc",1,"modal"],[1,"modal-header"],[1,"title-wrap"],["id","modalTitle",1,"modal-title"],[1,"ri-task-line",2,"font-size","20px","color","var(--accent)"],["id","titleLabel"],[1,"header-controls"],["id","closeBtn","aria-label","Fermer",1,"btn-icon",3,"click"],[1,"ri-close-line"],[1,"modal-body"],["aria-hidden","false",1,"form-col"],[1,"input-card","focus"],[1,"label-row"],[1,"label"],["id","dropzone","tabindex","0","aria-label","Zone de d\xe9p\xf4t de fichiers",1,"dropzone",3,"click","dragover","drop"],[1,"muted","small"],["id","fileInput","type","file","multiple","",2,"display","none",3,"change"],["id","filesPreview",2,"margin-top","10px","display","flex","flex-direction","column","gap","4px"],["class","file-preview",4,"ngFor","ngForOf"],[1,"modal-actions"],["id","cancelBtn",1,"btn","secondary",3,"click"],["id","saveBtn",1,"btn","primary",3,"click"],[1,"file-preview"],[1,"file-thumb"],[4,"ngIf","ngIfElse"],[1,"file-meta"],[2,"font-weight","400","font-size","10px"],[1,"file-size","muted",2,"font-size","10px"],[2,"margin-left","auto","display","flex","flex-direction","column","gap","6px","align-items","flex-end"],["title","Retirer",1,"remove-file",3,"click"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"src"],[1,"ri-file-line",2,"font-size","20px","color","#334155"]],template:function(n,i){if(1&n){const o=t.RV6();t.j41(0,"div",2),t.bIt("click",function(r){return t.eBV(o),t.Njj(i.onBackdropClick(r))}),t.j41(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),t.nrm(5,"i",7),t.j41(6,"span",8),t.EFF(7),t.k0s()()(),t.j41(8,"div",9)(9,"button",10),t.bIt("click",function(){return t.eBV(o),t.Njj(i.closeModal())}),t.nrm(10,"i",11),t.k0s()()(),t.j41(11,"div",12)(12,"div",13)(13,"div",14)(14,"div",15)(15,"div",16),t.EFF(16,"Pi\xe8ces jointes"),t.k0s()(),t.j41(17,"div",17),t.bIt("click",function(){return t.eBV(o),t.Njj(i.fileInputRef.nativeElement.click())})("dragover",function(r){return t.eBV(o),t.Njj(i.onDropzoneDragOver(r))})("drop",function(r){return t.eBV(o),t.Njj(i.onDropzoneDrop(r))}),t.j41(18,"div",18),t.EFF(19,"D\xe9poser des fichiers ou cliquer pour s\xe9lectionner"),t.k0s(),t.j41(20,"input",19,0),t.bIt("change",function(r){return t.eBV(o),t.Njj(i.onFileInputChange(r))}),t.k0s()(),t.j41(22,"div",20),t.DNE(23,Te,14,8,"div",21),t.k0s()()()(),t.j41(24,"div",22)(25,"button",23),t.bIt("click",function(){return t.eBV(o),t.Njj(i.closeModal())}),t.EFF(26,"Annuler"),t.k0s(),t.j41(27,"button",24),t.bIt("click",function(){return t.eBV(o),t.Njj(i.saveTask())}),t.EFF(28,"Enregistrer"),t.k0s()()()()}2&n&&(t.R7$(7),t.JRh(i.task.title?"Modifier la t\xe2che":"Nouvelle t\xe2che"),t.R7$(16),t.Y8G("ngForOf",i.files))},dependencies:[m.Sq,m.bT,m.QX],styles:["[_nghost-%COMP%]{--accent: #7c3aed;--accent-2: #6366f1;--bg: #f6f7fb;--card: rgba(255,255,255,.75);--glass-border: rgba(200,200,200,.18);--glass-shadow: 0 12px 34px rgba(18,25,40,.12);--radius-lg: 14px;--radius-md: 10px;--muted: #6b7280;--success: #10b981;--danger: #ef4444;--glass-blur: 10px;--transition: .22s cubic-bezier(.2,.9,.25,1);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}*[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[_nghost-%COMP%]{display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff9;backdrop-filter:blur(4px);z-index:1000;overflow-y:auto;overflow-x:hidden;animation:_ngcontent-%COMP%_backdropIn .26s var(--transition)}@keyframes _ngcontent-%COMP%_backdropIn{0%{opacity:0}to{opacity:1}}.modal[_ngcontent-%COMP%]{width:auto;max-width:50vh;max-height:90vh;border-radius:var(--radius-lg);background:linear-gradient(180deg,#fffffff2,#ffffffe6);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);backdrop-filter:blur(var(--glass-blur)) saturate(125%);overflow:hidden;display:flex;flex-direction:column;transform-origin:center;animation:_ngcontent-%COMP%_pop .26s var(--transition)}@keyframes _ngcontent-%COMP%_pop{0%{transform:translateY(10px) scale(.995);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 15px;border-bottom:1px solid rgba(15,23,42,.04);background:linear-gradient(90deg,#fff6,#fff3)}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.modal-title[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:700;color:#0b1220;display:flex;align-items:center;gap:10px}.pill-meta[_ngcontent-%COMP%]{font-size:.82rem;color:var(--muted);background:#6366f114;padding:6px 9px;border-radius:999px}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.btn-icon[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer;padding:8px;border-radius:8px;color:var(--muted);transition:all var(--transition);display:inline-flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]:hover{background:#0f172a0a;color:var(--accent);transform:translateY(-2px)}.modal-body[_ngcontent-%COMP%]{padding:18px;align-items:center;overflow-y:auto;overflow-x:hidden}.form-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.input-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);border-radius:12px;padding:4px;border:1px solid rgba(15,23,42,.03);transition:box-shadow var(--transition),transform var(--transition)}.input-card[_ngcontent-%COMP%]:focus-within{box-shadow:0 10px 30px #6366f112;transform:translateY(-2px)}.label-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.label-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--muted);font-weight:600}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.field[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;border:1px solid rgba(15,23,42,.04);background:#fff9}.field.focus[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 8px 20px #6366f117;transform:translateY(-2px)}.field[_ngcontent-%COMP%]   .fi-icon[_ngcontent-%COMP%]{color:#94a3b8;font-size:18px;margin-left:2px}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:.96rem;color:inherit;width:100%}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;padding-top:4px}.floating-label[_ngcontent-%COMP%]{position:absolute;top:10px;left:48px;font-size:.9rem;color:var(--muted);pointer-events:none;transform-origin:left top;transition:all var(--transition);background:linear-gradient(90deg,#fffffff2,#fffffff2);padding:0 6px;border-radius:6px}.field.filled[_ngcontent-%COMP%]   .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%]{transform:translateY(-22px) scale(.84);color:var(--accent)}.row-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.tag-picker[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap;font-size:12px}.tag-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 4px;border-radius:999px;background:linear-gradient(180deg,#ffffffb3,#ffffff80);border:1px solid rgba(15,23,42,.267);font-weight:600;cursor:pointer;transition:all var(--transition)}.tag-chip[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;box-shadow:0 2px 6px #0000000f}.tag-chip[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.tag-editor[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;margin-top:8px}.assignees[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:24px;font-size:11px;height:24px;border-radius:50%;display:inline-grid;place-items:center;font-weight:700;color:#fff;box-shadow:0 4px 12px #02061714;cursor:pointer}.avatar.small[_ngcontent-%COMP%]{width:18px;height:18px;font-size:8px}.avatar-list[_ngcontent-%COMP%]{display:flex;gap:2px;margin-top:6px;max-width:250px;overflow-x:scroll}.assignee-input[_ngcontent-%COMP%]{min-width:50px;padding:6px 10px;border-radius:12px;border:1px solid rgba(15,23,42,.397);background:#fff9}.assignee1[_ngcontent-%COMP%]{width:110px}.assignee2[_ngcontent-%COMP%]{width:160px}.checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;margin-top:2px}.ck-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);padding:0 2px;border-radius:10px;border:1px solid rgba(15,23,42,.26);transition:all var(--transition);cursor:grab}.ck-item[dragging=true][_ngcontent-%COMP%]{opacity:.6;transform:scale(.995)}.ck-item[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem}.ck-controls[_ngcontent-%COMP%]{display:flex;gap:3px;align-items:center}.dropzone[_ngcontent-%COMP%]{border:2px dashed rgba(15,23,42,.06);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;min-height:54px;transition:all var(--transition);background:linear-gradient(180deg,#ffffffa6,#fff9)}.dropzone.dragover[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 10px 30px #6366f10f}.file-preview[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding:8px 10px;border-radius:10px;background:#fff9;border:1px solid rgba(15,23,42,.03)}.file-thumb[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:8px;background:#eef2ff;display:grid;place-items:center;font-weight:700}.file-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#0b1220}.remove-file[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--danger);cursor:pointer}.file-size[_ngcontent-%COMP%]{font-size:.78rem;color:#64748b}.meta-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;position:relative}.card[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffffb3,#fff9);border:1px solid rgba(15,23,42,.03)}.preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-start}.meta-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px;align-items:center}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding:14px 18px;border-top:1px solid rgba(15,23,42,.04);flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;border:none;box-shadow:0 6px 18px #0206170a;transition:all var(--transition)}.btn.secondary[_ngcontent-%COMP%]{background:#f8fafc;color:#0b1220}.btn.primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 12px 30px #7c3aed2e}.btn.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(15,23,42,.04)}.muted[_ngcontent-%COMP%]{color:var(--muted);font-size:.85rem}.small[_ngcontent-%COMP%]{font-size:.82rem}.flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}@media (max-width: 980px){.modal[_ngcontent-%COMP%]{width:100%;max-width:95vw;max-height:95vh}.modal-body[_ngcontent-%COMP%]{grid-template-columns:1fr}.meta-col[_ngcontent-%COMP%]{order:2;width:100%}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.tag-picker[_ngcontent-%COMP%], .assignees[_ngcontent-%COMP%], .ck-item[_ngcontent-%COMP%]{flex-wrap:wrap;width:100%}.dropzone[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();const we=()=>[],U=(a,l)=>({"background-color":a,color:l}),De=(a,l)=>({"background-color":a,color:l,"font-weight":"bold"});function Ie(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",28),t.bIt("click",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.toggleDropdownTag(i))}),t.nrm(1,"i",29),t.EFF(2),t.k0s()}if(2&a){const e=l.ngIf;t.Y8G("ngStyle",t.l_i(2,U,e.bg,e.color)),t.R7$(2),t.SpI(" ",e.name," ")}}function je(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",32),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG(3);return t.Njj(o.selectTag(i))}),t.EFF(1),t.k0s()}if(2&a){const e=l.$implicit;t.Y8G("ngStyle",t.l_i(2,U,e.bg,e.color)),t.R7$(),t.SpI(" ",e.name," ")}}function Fe(a,l){if(1&a&&(t.j41(0,"div",30),t.DNE(1,je,2,5,"div",31),t.k0s()),2&a){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.provider.tagsList)}}function Ee(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",28),t.bIt("click",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.toggleDropdownPriority(i))}),t.EFF(1),t.k0s()}if(2&a){const e=l.ngIf;t.Y8G("ngStyle",t.l_i(2,De,e.small.bg,e.small.color)),t.R7$(),t.SpI(" ",e.name," ")}}function Re(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",32),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG(3);return t.Njj(o.selectPriority(i))}),t.EFF(1),t.k0s()}if(2&a){const e=l.$implicit;t.Y8G("ngStyle",t.l_i(2,U,e.small.bg,e.small.color)),t.R7$(),t.SpI(" ",e.name," ")}}function Ae(a,l){if(1&a&&(t.j41(0,"div",33),t.DNE(1,Re,2,5,"div",31),t.k0s()),2&a){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.provider.prioritiesList)}}function Be(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",34)(1,"button",35),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.deleteTask())}),t.nrm(2,"i",36),t.EFF(3," Supprimer "),t.k0s(),t.j41(4,"button",35),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.editTask())}),t.nrm(5,"i",37),t.EFF(6," Modifier "),t.k0s(),t.j41(7,"button",35),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.shareTask())}),t.nrm(8,"i",38),t.EFF(9," Partager "),t.k0s(),t.j41(10,"button",35),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.assignTask())}),t.nrm(11,"i",39),t.EFF(12," Assigner "),t.k0s()()}}function Se(a,l){if(1&a){const e=t.RV6();t.j41(0,"article",1)(1,"div",2)(2,"div",3)(3,"div",4),t.DNE(4,Ie,3,5,"div",5)(5,Fe,2,1,"div",6),t.k0s(),t.j41(6,"div",7),t.DNE(7,Ee,2,5,"div",5)(8,Ae,2,1,"div",8),t.k0s()(),t.j41(9,"div",9)(10,"button",10),t.bIt("click",function(i){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleMenu(i))}),t.nrm(11,"i",11),t.k0s(),t.DNE(12,Be,13,0,"div",12),t.k0s()(),t.j41(13,"h4",13),t.EFF(14),t.k0s(),t.j41(15,"div",14),t.EFF(16),t.k0s(),t.j41(17,"div",15)(18,"div",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openCheckListModal())}),t.nrm(19,"i",17),t.EFF(20),t.k0s()(),t.nrm(21,"div",18),t.j41(22,"div",19)(23,"div",20),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openViewsModal())}),t.nrm(24,"i",21),t.j41(25,"span",22),t.EFF(26),t.k0s()(),t.j41(27,"div",23),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openCommentsModal())}),t.nrm(28,"i",24),t.j41(29,"span",25),t.EFF(30,"..."),t.k0s(),t.j41(31,"span",22),t.EFF(32),t.k0s()(),t.j41(33,"div",26),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openTaskFilesModal())}),t.nrm(34,"i",27),t.j41(35,"span",22),t.EFF(36),t.k0s()()()()}if(2&a){let e;const n=l.ngIf,i=t.XpG();t.R7$(4),t.Y8G("ngIf",i.selectedTag()),t.R7$(),t.Y8G("ngIf",i.openDropdownTagId==(null==n.tag?null:n.tag.id)),t.R7$(2),t.Y8G("ngIf",i.selectedPriority()),t.R7$(),t.Y8G("ngIf",i.openDropdownPriorityId==(null==n.priority?null:n.priority.id)),t.R7$(4),t.Y8G("ngIf",i.openMenuId===n.id),t.R7$(2),t.JRh(n.title),t.R7$(2),t.JRh(n.description),t.R7$(2),t.Y8G("ngClass",i.isChecklistFinished()?"finished":"unfinished"),t.R7$(2),t.SpI(" ",i.getChecklistProgress()," "),t.R7$(6),t.JRh(i.getObjectTotal(n.views)),t.R7$(6),t.JRh((null!==(e=null==n?null:n.comments)&&void 0!==e?e:t.lJ4(12,we)).length),t.R7$(4),t.JRh(i.getAttachmentsTotal(n.attachments))}}let ze=(()=>{class a{constructor(e,n,i,o){this.dialog=e,this.userCtx=n,this.taskService=i,this.provider=o,this.onDragStartTask=new t.bkB,this.onTaskUpdated=new t.bkB,this.onEditTask=new t.bkB,this.onDeleteTask=new t.bkB,this.onShareTask=new t.bkB,this.onAssignTask=new t.bkB,this.openDropdownTagId=null,this.openDropdownPriorityId=null,this.tagsList=[],this.openMenuId=null;const{uid:s}=this.userCtx.requireUser();this.userId=s}ngOnInit(){}openViewsModal(){var e=this;return(0,c.A)(function*(){e.task.views[e.userId]={at:Date.now()},yield e.taskService.update(e.task),e.dialog.open(ke,{width:"500px",maxHeight:"80vh",data:{task:e.task}}).afterClosed().subscribe(o=>{})})()}openCommentsModal(){this.dialog.open(le,{width:"500px",maxHeight:"80vh",data:{task:this.task}}).afterClosed().subscribe(n=>{n&&console.log("New comment received:",n)})}openCheckListModal(){this.dialog.open(ve,{width:"500px",maxHeight:"80vh",data:{task:this.task}}).afterClosed().subscribe(n=>{})}openTaskFilesModal(){this.dialog.open(Pe,{width:"500px",maxHeight:"80vh",data:{task:this.task}}).afterClosed().subscribe(n=>{})}initComponentElements(){document.querySelectorAll(".more-btn").forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation();const i=e.nextElementSibling;document.querySelectorAll(".more-menu").forEach(o=>{o!==i&&(o.style.display="none")}),i.style.display="block"===i.style.display?"none":"block"})}),document.addEventListener("click",()=>{document.querySelectorAll(".more-menu").forEach(e=>e.style.display="none")})}getObjectTotal(e){return e?Object.keys(e).length:0}getAttachmentsTotal(e,n=!0){return e?n?Object.values(e).reduce((i,o)=>i+(o.files?.length||0),0):e?Object.keys(e).length:0:0}onDragStart(e,n){this.onDragStartTask.emit({event:e,task:this.task}),e.dataTransfer&&(e.dataTransfer.setData("text/plain",this.task.id),e.dataTransfer.effectAllowed="move")}toggleMenu(e){e.stopPropagation(),this.openMenuId=this.openMenuId===this.task.id?null:this.task.id}editTask(){this.onEditTask.emit(this.task),this.openMenuId=null}deleteTask(){confirm("Voulez-vous vraiment supprimer cette t\xe2che ?")&&(this.onDeleteTask.emit(this.task),this.openMenuId=null)}shareTask(){this.onShareTask.emit(this.task),this.openMenuId=null}assignTask(){this.onAssignTask.emit(this.task),this.openMenuId=null}getTagClass(e){switch(e.toLowerCase()){case"urgent":return"tag-urgent";case"bug":return"tag-bug";case"feature":return"tag-feature";case"review":return"tag-review";default:return"tag-default"}}toggleDropdownTag(e){const n=this.task.tag?.id;this.openDropdownTagId=n&&this.openDropdownTagId!==n?n:null}selectedTag(){return this.provider.tagsList.find(e=>e.id==this.task.tag?.id)||this.provider.defaultTag}selectTag(e){this.task.tag=e,this.taskService.update(this.task)}toggleDropdownPriority(e){const n=this.task.priority?.id;this.openDropdownPriorityId=n&&this.openDropdownPriorityId!==n?n:null}selectedPriority(){return this.provider.prioritiesList.find(e=>e.id==this.task.priority?.id)||this.provider.defaultPriority}selectPriority(e){this.task.priority=e,this.taskService.update(this.task)}isChecklistFinished(){const e=this.task.checklist?this.task.checklist.filter(i=>1==i.done?.ok).length:0,n=this.task.checklist?this.task.checklist.length:0;return n>0&&e===n&&"done"==this.task.columnId}getChecklistProgress(){return this.task.checklist?`${this.task.checklist.filter(e=>1==e.done?.ok).length}/${this.task.checklist.length}`:"0/0"}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(A),t.rXU(x.i),t.rXU(j),t.rXU(w))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-task-builder"]],inputs:{userId:"userId",task:"task",columnId:"columnId"},outputs:{onDragStartTask:"onDragStartTask",onTaskUpdated:"onTaskUpdated",onEditTask:"onEditTask",onDeleteTask:"onDeleteTask",onShareTask:"onShareTask",onAssignTask:"onAssignTask"},standalone:!1,decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[2,"display","inline-flex","gap","2px"],[1,"tags"],["class","pill","tabindex","0",3,"ngStyle","click",4,"ngIf"],["class","more-tags",4,"ngIf"],[1,"priorities"],["class","more-priorities",4,"ngIf"],[1,"more-options"],["aria-label","Options",1,"more-btn",3,"click"],[1,"fa-solid","fa-ellipsis-vertical"],["class","more-menu",4,"ngIf"],[1,"card-title"],[1,"desc"],[1,"meta"],[1,"stat",3,"click","ngClass"],[1,"fa-solid","fa-list-check"],[1,"divider"],[1,"stats"],[1,"stat-item","view-outline",3,"click"],[1,"fa-regular","fa-eye"],[1,"count"],[1,"stat-item","comment-outline",3,"click"],[1,"fa-regular","fa-message"],[1,"dots"],[1,"stat-item",3,"click"],[1,"fa-solid","fa-paperclip"],["tabindex","0",1,"pill",3,"click","ngStyle"],[1,"ri-price-tag-3-line"],[1,"more-tags"],["class","option",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"option",3,"click","ngStyle"],[1,"more-priorities"],[1,"more-menu"],[1,"option",3,"click"],[1,"fa-solid","fa-trash"],[1,"fa-solid","fa-pen"],[1,"fa-solid","fa-share-nodes"],[1,"fa-solid","fa-user-plus"]],template:function(n,i){1&n&&t.DNE(0,Se,37,13,"article",0),2&n&&t.Y8G("ngIf",i.task)},dependencies:[m.YU,m.Sq,m.bT,m.B3],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--bg: #f6f7fb;--card: #ffffff;--muted: #9aa3b2;--accent: #4f6cff;--accent-600: #3658d1;--pill-bg: #fff6e8;--glass: rgba(255, 255, 255, .6);--shadow: 0 6px 18px rgba(38, 43, 55, .08);--radius: 12px;--success: #16a34a;--danger: #ef4444}.card[_ngcontent-%COMP%]{background:var(--card);border-radius:8px;padding:15px;box-shadow:var(--shadow);cursor:grab;border:1px solid #f0f3f7;margin-bottom:10px;transition:transform .18s cubic-bezier(.2,.9,.2,1),box-shadow .18s}.card.dragging[_ngcontent-%COMP%]{opacity:.85;transform:scale(1.04);cursor:grabbing}.card.drop-anim[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_cardDrop .28s ease}@keyframes _ngcontent-%COMP%_cardDrop{0%{transform:translateY(-6px) scale(.995);opacity:0}to{transform:none;opacity:1}}.card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 6px;font-size:15px}.desc[_ngcontent-%COMP%]{color:var(--muted);font-size:13px;line-height:1.3;margin-bottom:8px;white-space:pre-wrap}.meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#6b7280;font-size:12px;flex-wrap:wrap}.meta[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:6px;font-weight:500;font-size:12px;transition:all .2s ease-in-out;cursor:default}.meta[_ngcontent-%COMP%]   .stat.unfinished[_ngcontent-%COMP%]{border:1px solid #e0e7ff;color:#4b5563;background-color:#f3f4f6;box-shadow:inset 0 1px 2px #0000000d}.meta[_ngcontent-%COMP%]   .stat.finished[_ngcontent-%COMP%]{border:1px solid #16a34a;color:#065f46;background-color:#d1fae5;box-shadow:0 1px 3px #16a34a4d}.meta[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 6px #0000001a}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.more-options[_ngcontent-%COMP%]{position:relative}.more-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;font-size:18px;padding:2px 6px;color:var(--muted)}.more-btn[_ngcontent-%COMP%]:hover{color:var(--accent)}.more-menu[_ngcontent-%COMP%]{position:absolute;top:120%;right:0;background:var(--card);box-shadow:var(--shadow);border-radius:6px;flex-direction:column;min-width:120px;z-index:20}.more-menu.show[_ngcontent-%COMP%]{display:flex}.more-menu[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{padding:8px 12px;border:none;background:none;text-align:left;cursor:pointer}.more-menu[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover{background:#f0f4ff}.divider[_ngcontent-%COMP%]{border-top:1px solid #f0f3f7;margin:12px 0}.stats[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:1rem;font-size:14px}.stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;color:var(--muted)}.count[_ngcontent-%COMP%]{font-size:12px;color:var(--muted)}.comment-outline[_ngcontent-%COMP%]{position:relative}.comment-outline[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]{position:absolute;top:22%;left:29%;transform:translate(-50%,-50%);font-size:.75em;color:inherit;pointer-events:none}.tags[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]{position:relative;display:inline-block;margin:0}.tags[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 7px;border-radius:20px;font-size:.9rem;font-weight:500;background:var(--pill-bg);color:#b86f00;cursor:pointer;-webkit-user-select:none;user-select:none;transition:all .2s ease;outline:none}.tags[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;opacity:.8}.tags[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:hover, .tags[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:focus, .priorities[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:hover, .priorities[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:focus{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.tags[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%], .tags[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 6px);left:0;background:#fff;border:1px solid #e0e0e0;border-radius:10px;box-shadow:0 6px 16px #0000001f;display:flex;flex-direction:column;min-width:160px;z-index:20;padding:0;animation:_ngcontent-%COMP%_dropdownFade .2s ease}.tags[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%], .tags[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%], .priorities[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{padding:8px 14px;font-size:.9rem;text-align:left;background:transparent;border:none;cursor:pointer;transition:background .2s,color .2s}.tags[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover, .tags[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover, .priorities[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover, .priorities[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover{background:#f0f4ff;color:#007bff}.tags[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:focus, .tags[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:focus, .priorities[_ngcontent-%COMP%]   .more-tags[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:focus, .priorities[_ngcontent-%COMP%]   .more-priorities[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:focus{outline:none;background:#e6f0ff}@keyframes _ngcontent-%COMP%_dropdownFade{0%{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}']})}}return a})();const Ge=["fileInput"];function Ve(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",60),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.selectTag(i))}),t.nrm(1,"input",61),t.j41(2,"span"),t.EFF(3),t.k0s(),t.j41(4,"span",62),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeTag(i))}),t.EFF(5,"x"),t.k0s()()}if(2&a){const e=l.$implicit,n=t.XpG();t.xc7("background",n.isTagSelected(e)?e.color:n.provider.withOpacity(e.color,.1)),t.R7$(),t.Y8G("checked",n.isTagSelected(e))("readOnly",!0),t.R7$(),t.xc7("color",n.isTagSelected(e)?"white":e.color),t.R7$(),t.JRh(e.name)}}function Le(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",63),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeAssignee(i))}),t.EFF(1),t.k0s()}if(2&a){const e=l.$implicit,n=t.XpG();t.xc7("background",e.color),t.Y8G("title",e.displayName||e.email),t.R7$(),t.SpI(" ",n.getInitials(e.displayName||e.email)," ")}}function $e(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",65),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,o=t.XpG();return t.Njj(o.toggleAddAssignee(i))}),t.EFF(1),t.k0s()}if(2&a){const e=t.XpG().$implicit,n=t.XpG();t.xc7("background",e.color),t.FCK("title","",e.displayName||"","",e.email?"\n"+e.email:"",""),t.R7$(),t.SpI(" ",n.getInitials(e.displayName||e.email)," ")}}function Ne(a,l){if(1&a&&(t.qex(0),t.DNE(1,$e,2,6,"div",64),t.bVm()),2&a){const e=l.$implicit,n=t.XpG();t.R7$(),t.Y8G("ngIf",!n.isSelectedUser(e))}}function Xe(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",66),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.selectPriority(i))}),t.nrm(1,"input",67),t.j41(2,"div",68),t.EFF(3),t.k0s()()}if(2&a){const e=l.$implicit,n=t.XpG();t.xc7("background",n.isPrioritySelected(e)?e.big.bg:"none")("color",n.isPrioritySelected(e)?e.big.color:"none"),t.Y8G("title",e.name),t.BMQ("data-priority",e.id),t.R7$(),t.Y8G("checked",n.isPrioritySelected(e))("readOnly",!0),t.R7$(),t.xc7("color",e.small.bg),t.R7$(),t.JRh(e.label||"Low")}}function Ue(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",69),t.bIt("dragstart",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onCheckDragStart(i,o.id))})("dragend",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCheckDragEnd())})("dragover",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onCheckDragOver(i,o.id))}),t.j41(1,"input",70),t.bIt("change",function(i){const o=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.onDoneChange(i,o))}),t.k0s(),t.j41(2,"input",71),t.mxI("ngModelChange",function(i){const o=t.eBV(e).$implicit;return t.DH7(o.name,i)||(o.name=i),t.Njj(i)}),t.k0s(),t.j41(3,"div",72)(4,"button",73),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.duplicateCheckItem(i.id))}),t.EFF(5," Cloner "),t.k0s(),t.j41(6,"button",74),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeCheckItem(i.id))}),t.EFF(7," X "),t.k0s()()()}if(2&a){const e=l.$implicit;t.BMQ("data-id",e.id),t.R7$(),t.Y8G("checked",null==e.done?null:e.done.ok),t.R7$(),t.R50("ngModel",e.name)}}function Ye(a,l){if(1&a&&(t.qex(0),t.nrm(1,"img",83),t.bVm()),2&a){const e=t.XpG().$implicit;t.R7$(),t.Y8G("src",e.url,t.B4B)}}function He(a,l){1&a&&t.nrm(0,"i",84)}function Qe(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",75)(1,"div",76),t.DNE(2,Ye,2,1,"ng-container",77)(3,He,1,0,"ng-template",null,1,t.C5r),t.k0s(),t.j41(5,"div",78)(6,"div",79),t.EFF(7),t.k0s(),t.j41(8,"div",80),t.EFF(9),t.nI1(10,"number"),t.k0s()(),t.j41(11,"div",81)(12,"button",82),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.removeFile(i.id))}),t.nrm(13,"i",11),t.k0s()()()}if(2&a){const e=l.$implicit,n=t.sdS(4);t.BMQ("data-id",e.id),t.R7$(2),t.Y8G("ngIf",e.url)("ngIfElse",n),t.R7$(5),t.JRh(e.name),t.R7$(2),t.SpI("",t.i5U(10,5,e.size/1024,"1.0-0")," KB")}}let We=(()=>{class a{constructor(e,n,i){this.el=e,this.provider=n,this.userService=i,this.task=null,this.save=new t.bkB,this.close=new t.bkB,this.editedTask={},this.draggingId=null,this.state={tags:[],assignees:[],checklist:[],files:[],assigneeQuery:"",newCheckText:"",priority:"",newTag:{name:"",color:"#ff7a7a"},usersList:[],prioritiesList:[]}}onPaste(e){const n=e.clipboardData?.files;n&&n.length&&this.handleFiles(Array.from(n))}handleKeydown(e){"Escape"===e.key&&this.closeModal(),(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.saveTask())}get newTask(){return{id:"t"+Math.random().toString(36).slice(2,9),title:"",description:"",tag:this.provider.defaultTag,checklist:[],assignTo:{},priority:this.provider.defaultPriority,views:{},comments:[],attachments:{},due:void 0,columnId:this.columnId,owner:this.userId,position:0}}uid(e="id"){return e+Math.random().toString(36).slice(2,9)}ngOnInit(){this.initializeApp()}initializeApp(){var e=this;return(0,c.A)(function*(){e.editedTask=e.task?{...e.task}:e.newTask,e.state.usersList=yield e.userService.getUsers(),e.state.prioritiesList=e.provider.prioritiesList,e.state.tags=[...e.provider.tagsList],e.state.assignees=e.state.usersList.filter(n=>Object.keys(e.editedTask.assignTo??{}).includes(n.uid)),e.state.checklist=e.editedTask.checklist??[],e.state.files=Object.values(e.editedTask.attachments).flatMap(n=>n.files)})()}ngOnDestroy(){this.state.files.forEach(e=>{if(e.url)try{URL.revokeObjectURL(e.url)}catch{}})}onBackdropClick(e){const n=e.target;n&&"backdrop"===n.id&&this.closeModal()}getInitials(e){return e?e.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():""}getAssigneeNames(){return this.state?.assignees&&0!==this.state.assignees.length?this.state.assignees.map(e=>e.displayName||e.email).join(", "):"\u2014"}selectPriority(e,n){this.editedTask.priority=this.editedTask.priority?.id==e.id?void 0:e}cancelPriority(e,n){this.editedTask.priority=void 0}isPrioritySelected(e,n){return this.editedTask.priority==e}addTag(){const e=this.state.newTag.name.trim();if(!e)return;const n=this.state.newTag.color||"#ff7a7a",i={id:this.uid("tag"),name:e,color:n,bg:n};this.state.tags=[i,...this.state.tags],this.state.newTag={name:"",color:"#ff7a7a"}}selectTag(e,n){e.bg=this.provider.withOpacity(e.color,.1),this.editedTask.tag=this.isTagSelected(e)?this.provider.defaultTag:e}isTagSelected(e,n){return this.editedTask.tag?.id===e.id}removeTag(e,n){this.state.tags=this.state.tags.filter(i=>i.id!==e.id)}addAssigneeFromQuery(){const e=this.state.assigneeQuery.trim().toLowerCase();if(!e)return;const n=this.state.usersList.find(i=>`${i.displayName??""} ${i.email??""}`.toLowerCase().includes(e)&&!this.state.assignees.some(o=>o.uid===i.uid));n&&(this.state.assignees.push(n),this.state.assigneeQuery="")}isSelectedUser(e){return this.state.assignees.map(n=>n.uid).includes(e.uid)}toggleAddAssignee(e){this.state.assignees.some(n=>n.uid===e.uid)||this.state.assignees.push(e)}removeAssignee(e){this.state.assignees=this.state.assignees.filter(n=>n.uid!==e.uid)}onDoneChange(e,n){const i=e.target.checked;n.done={ok:i,by:i?this.userId??"Unknown User":"",at:i?Date.now():0}}addCheckItem(){const e=this.state.newCheckText.trim();if(!e)return;const n=this.userId??"Unknown User",i={id:this.uid("ck"),name:e,created:{by:n,at:Date.now()}};this.state.checklist.push(i),this.state.newCheckText=""}removeCheckItem(e){this.state.checklist=this.state.checklist.filter(n=>n.id!==e)}duplicateCheckItem(e){const n=this.state.checklist.find(r=>r.id===e);if(!n)return;const i=this.userId??"Unknown User",o={id:this.uid("ck"),name:n.name,created:{by:i,at:Date.now()}},s=this.state.checklist.findIndex(r=>r.id===e);this.state.checklist.splice(s+1,0,o)}onCheckDragStart(e,n){this.draggingId=n,e.dataTransfer?.setData("text/plain",n),setTimeout(()=>{},10)}onCheckDragEnd(){this.draggingId=null}onCheckDragOver(e,n){if(e.preventDefault(),!this.draggingId||this.draggingId===n)return;const i=this.state.checklist.findIndex(r=>r.id===this.draggingId),o=this.state.checklist.findIndex(r=>r.id===n);if(-1===i||-1===o)return;const[s]=this.state.checklist.splice(i,1);this.state.checklist.splice(o,0,s)}onFileInputChange(e){const n=e.target,i=n.files?Array.from(n.files):[];this.handleFiles(i),n.value=""}handleFiles(e){e.forEach(n=>{const o={id:this.uid("f"),file:n,url:"",name:n.name,size:n.size};n.type.startsWith("image/")&&(o.url=URL.createObjectURL(n)),this.state.files.push(o)})}removeFile(e){const n=this.state.files.findIndex(i=>i.id===e);if(n>-1){const i=this.state.files[n];if(i.url)try{URL.revokeObjectURL(i.url)}catch{}this.state.files.splice(n,1)}}onDropzoneDragOver(e){e.preventDefault()}onDropzoneDrop(e){e.preventDefault();const n=e.dataTransfer?.files?Array.from(e.dataTransfer.files):[];n.length&&this.handleFiles(n)}saveTask(){if(this.editedTask.title){if(this.state.assignees&&this.state.assignees.length>0){this.editedTask.assignTo||(this.editedTask.assignTo={});for(const e of this.state.assignees)this.editedTask.assignTo[e.uid]={at:Date.now()}}if(this.state.checklist&&this.state.checklist.length>0&&(this.editedTask.checklist=this.state.checklist.flatMap(e=>({id:e.id,name:e.name,done:e.done,created:e.created,updated:e.updated}))),this.state.files.length>0){this.editedTask.attachments||(this.editedTask.attachments={});const e=this.state.files.map(n=>({id:n.id,name:n.name,url:n.url,file:n.file,size:n.size}));this.editedTask.attachments[this.userId]={at:Date.now(),files:e}}this.save.emit(this.editedTask)}else{alert("Le titre est requis");const e=this.el.nativeElement.querySelector("#titleInput");e&&e.focus()}}closeModal(){this.close.emit(!1)}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(t.aKT),t.rXU(w),t.rXU(X))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-task-modal"]],viewQuery:function(n,i){if(1&n&&t.GBs(Ge,5),2&n){let o;t.mGM(o=t.lsd())&&(i.fileInputRef=o.first)}},hostBindings:function(n,i){1&n&&t.bIt("paste",function(s){return i.onPaste(s)},!1,t.tSv)("keydown",function(s){return i.handleKeydown(s)},!1,t.tSv)},inputs:{task:"task",columnId:"columnId",userId:"userId"},outputs:{save:"save",close:"close"},standalone:!1,decls:93,vars:21,consts:[["fileInput",""],["fileIcon",""],["id","backdrop","role","dialog","aria-modal","true","aria-labelledby","modalTitle",1,"modal-backdrop",3,"click"],["role","document","aria-describedby","modalDesc",1,"modal"],[1,"modal-header"],[1,"title-wrap"],["id","modalTitle",1,"modal-title"],[1,"ri-task-line",2,"font-size","20px","color","var(--accent)"],["id","titleLabel"],[1,"header-controls"],["id","closeBtn","aria-label","Fermer",1,"btn-icon",3,"click"],[1,"ri-close-line"],[1,"modal-body"],["aria-hidden","false",1,"form-col"],["role","group","aria-labelledby","labelTitle",1,"input-card","focus"],["for","titleInput",1,"label-row"],["id","labelTitle",1,"label"],[1,"ri-edit-2-line","fi-icon"],["for","titleInput","data-field","title","id","fieldTitle",1,"field"],["id","titleInput","type","text","placeholder"," ","aria-required","true",3,"ngModelChange","ngModel"],[1,"input-card","focus"],["for","descInput",1,"label-row"],[1,"label"],[1,"ri-file-text-line","fi-icon"],["for","descInput","data-field","desc","id","fieldDesc",1,"field"],["id","descInput","placeholder"," ",3,"ngModelChange","ngModel"],[1,"row-2"],[1,"label-row"],["id","tagsList",1,"tag-picker"],["class","tag-chip",3,"background","click",4,"ngFor","ngForOf"],[1,"tag-editor"],["id","newTagName","type","text","placeholder","Ajouter une \xe9tiquette (ex: Urgent)",1,"assignee-input","assignee1",3,"ngModelChange","ngModel"],["id","newTagColor","type","color",2,"width","25px","height","25px","border-radius","4px","border","none","cursor","pointer",3,"ngModelChange","ngModel"],["id","createTagBtn",1,"btn",2,"padding","2px","font-size","8px",3,"click"],[2,"display","flex","gap","8px","align-items","center"],["id","assigneeList",1,"assignees"],["class","avatar small",3,"title","background","click",4,"ngFor","ngForOf"],["id","assigneeInput","placeholder","Rechercher un user...",1,"assignee-input","assignee2",3,"ngModelChange","keydown.enter","ngModel"],[1,"muted","small",2,"margin-top","8px"],["id","assigneesCount"],[1,"avatar-list"],[4,"ngFor","ngForOf"],["id","fieldDue",1,"field"],[1,"ri-calendar-line","fi-icon"],["id","dueInput","type","date",3,"ngModelChange","ngModel"],["id","prioritiesList",1,"tag-picker"],["class","tag-chip",3,"background","color","title","click",4,"ngFor","ngForOf"],["id","checklist",1,"checklist"],["class","ck-item","draggable","true",3,"dragstart","dragend","dragover",4,"ngFor","ngForOf"],[2,"display","flex","gap","4px","margin-top","10px"],["id","newCheckInput","placeholder","Nouvel \xe9l\xe9ment de checklist...",1,"assignee-input","assignee3",3,"ngModelChange","keydown.enter","ngModel"],["id","addCheckBtn",1,"btn","ghost",3,"click"],["id","dropzone","tabindex","0","aria-label","Zone de d\xe9p\xf4t de fichiers",1,"dropzone",3,"click","dragover","drop"],[1,"muted","small"],["id","fileInput","type","file","multiple","",2,"display","none",3,"change"],["id","filesPreview",2,"margin-top","10px","display","flex","flex-direction","column","gap","8px"],["class","file-preview",4,"ngFor","ngForOf"],[1,"modal-actions"],["id","cancelBtn",1,"btn","secondary",3,"click"],["id","saveBtn",1,"btn","primary",3,"click"],[1,"tag-chip",3,"click"],["type","radio","name","tagy",2,"margin","0px","padding","0px",3,"checked","readOnly"],[2,"margin-left","5px","color","red","cursor","pointer",3,"click"],[1,"avatar","small",3,"click","title"],["class","avatar",3,"background","title","click",4,"ngIf"],[1,"avatar",3,"click","title"],[1,"tag-chip",3,"click","title"],["type","radio","name","priority",2,"margin","0px","padding","0px",3,"checked","readOnly"],[2,"margin-right","2px"],["draggable","true",1,"ck-item",3,"dragstart","dragend","dragover"],["type","checkbox","aria-label","Done",2,"zoom","1.5",3,"change","checked"],["type","text","placeholder","\xc9l\xe9ment",3,"ngModelChange","ngModel"],[1,"ck-controls"],["title","Dupliquer",1,"btn","ghost","small",2,"padding","4px",3,"click"],["title","Supprimer",1,"btn","ghost","small",2,"padding","4px",3,"click"],[1,"file-preview"],[1,"file-thumb"],[4,"ngIf","ngIfElse"],[1,"file-meta"],[2,"font-weight","700"],[1,"file-size","muted"],[2,"margin-left","auto","display","flex","flex-direction","column","gap","6px","align-items","flex-end"],["title","Retirer",1,"remove-file",3,"click"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"src"],[1,"ri-file-line",2,"font-size","20px","color","#334155"]],template:function(n,i){if(1&n){const o=t.RV6();t.j41(0,"div",2),t.bIt("click",function(r){return t.eBV(o),t.Njj(i.onBackdropClick(r))}),t.j41(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),t.nrm(5,"i",7),t.j41(6,"span",8),t.EFF(7),t.k0s()()(),t.j41(8,"div",9)(9,"button",10),t.bIt("click",function(){return t.eBV(o),t.Njj(i.closeModal())}),t.nrm(10,"i",11),t.k0s()()(),t.j41(11,"div",12)(12,"div",13)(13,"div",14)(14,"label",15)(15,"div",16),t.nrm(16,"i",17),t.EFF(17," Titre de la t\xe2che "),t.k0s()(),t.j41(18,"label",18)(19,"input",19),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.editedTask.title,r)||(i.editedTask.title=r),t.Njj(r)}),t.k0s()()(),t.j41(20,"div",20)(21,"label",21)(22,"div",22),t.nrm(23,"i",23),t.EFF(24," Description"),t.k0s()(),t.j41(25,"label",24)(26,"textarea",25),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.editedTask.description,r)||(i.editedTask.description=r),t.Njj(r)}),t.k0s()()(),t.j41(27,"div",26)(28,"div",20)(29,"div",27)(30,"div",22),t.EFF(31,"\xc9tiquette"),t.k0s()(),t.j41(32,"div",28),t.DNE(33,Ve,6,7,"div",29),t.k0s(),t.j41(34,"div",30)(35,"input",31),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.state.newTag.name,r)||(i.state.newTag.name=r),t.Njj(r)}),t.k0s(),t.j41(36,"input",32),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.state.newTag.color,r)||(i.state.newTag.color=r),t.Njj(r)}),t.k0s(),t.j41(37,"button",33),t.bIt("click",function(){return t.eBV(o),t.Njj(i.addTag())}),t.EFF(38,"Cr\xe9er"),t.k0s()()(),t.j41(39,"div",20)(40,"div",27)(41,"div",22),t.EFF(42,"Assigner"),t.k0s()(),t.j41(43,"div",34)(44,"div",35),t.DNE(45,Le,2,4,"div",36),t.k0s(),t.j41(46,"input",37),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.state.assigneeQuery,r)||(i.state.assigneeQuery=r),t.Njj(r)}),t.bIt("keydown.enter",function(){return t.eBV(o),t.Njj(i.addAssigneeFromQuery())}),t.k0s()(),t.j41(47,"div",38),t.EFF(48,"Selectionn\xe9s : "),t.j41(49,"span",39),t.EFF(50),t.k0s()(),t.j41(51,"div",40),t.DNE(52,Ne,2,1,"ng-container",41),t.k0s()()(),t.j41(53,"div",26)(54,"div",20)(55,"div",27)(56,"div",22),t.EFF(57,"Date limite"),t.k0s()(),t.j41(58,"div",42),t.nrm(59,"i",43),t.j41(60,"input",44),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.editedTask.due,r)||(i.editedTask.due=r),t.Njj(r)}),t.k0s()()(),t.j41(61,"div",20)(62,"div",27)(63,"div",22),t.EFF(64,"Priorit\xe9"),t.k0s()(),t.j41(65,"div",45),t.DNE(66,Xe,4,11,"div",46),t.k0s()()(),t.j41(67,"div",20)(68,"div",27)(69,"div",22),t.EFF(70,"Checklist"),t.k0s()(),t.j41(71,"div",47),t.DNE(72,Ue,8,3,"div",48),t.k0s(),t.j41(73,"div",49)(74,"input",50),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.state.newCheckText,r)||(i.state.newCheckText=r),t.Njj(r)}),t.bIt("keydown.enter",function(){return t.eBV(o),t.Njj(i.addCheckItem())}),t.k0s(),t.j41(75,"button",51),t.bIt("click",function(){return t.eBV(o),t.Njj(i.addCheckItem())}),t.EFF(76,"Ajouter"),t.k0s()()(),t.j41(77,"div",20)(78,"div",27)(79,"div",22),t.EFF(80,"Pi\xe8ces jointes"),t.k0s()(),t.j41(81,"div",52),t.bIt("click",function(){return t.eBV(o),t.Njj(i.fileInputRef.nativeElement.click())})("dragover",function(r){return t.eBV(o),t.Njj(i.onDropzoneDragOver(r))})("drop",function(r){return t.eBV(o),t.Njj(i.onDropzoneDrop(r))}),t.j41(82,"div",53),t.EFF(83,"D\xe9poser des fichiers ou cliquer pour s\xe9lectionner"),t.k0s(),t.j41(84,"input",54,0),t.bIt("change",function(r){return t.eBV(o),t.Njj(i.onFileInputChange(r))}),t.k0s()(),t.j41(86,"div",55),t.DNE(87,Qe,14,8,"div",56),t.k0s()()()(),t.j41(88,"div",57)(89,"button",58),t.bIt("click",function(){return t.eBV(o),t.Njj(i.closeModal())}),t.EFF(90,"Annuler"),t.k0s(),t.j41(91,"button",59),t.bIt("click",function(){return t.eBV(o),t.Njj(i.saveTask())}),t.EFF(92,"Enregistrer"),t.k0s()()()()}2&n&&(t.R7$(7),t.JRh(i.editedTask.title?"Modifier la t\xe2che":"Nouvelle t\xe2che"),t.R7$(11),t.AVh("filled",(i.editedTask.title||"").trim()),t.R7$(),t.R50("ngModel",i.editedTask.title),t.R7$(6),t.AVh("filled",i.editedTask.description.trim()),t.R7$(),t.R50("ngModel",i.editedTask.description),t.R7$(7),t.Y8G("ngForOf",i.state.tags),t.R7$(2),t.R50("ngModel",i.state.newTag.name),t.R7$(),t.R50("ngModel",i.state.newTag.color),t.R7$(9),t.Y8G("ngForOf",i.state.assignees),t.R7$(),t.R50("ngModel",i.state.assigneeQuery),t.R7$(4),t.JRh(i.state.assignees.length),t.R7$(2),t.Y8G("ngForOf",i.state.usersList),t.R7$(6),t.AVh("filled",i.editedTask.due),t.R7$(2),t.R50("ngModel",i.editedTask.due),t.R7$(6),t.Y8G("ngForOf",i.state.prioritiesList),t.R7$(6),t.Y8G("ngForOf",i.state.checklist),t.R7$(2),t.R50("ngModel",i.state.newCheckText),t.R7$(13),t.Y8G("ngForOf",i.state.files))},dependencies:[m.Sq,m.bT,_.me,_.BC,_.vS,m.QX],styles:["[_nghost-%COMP%]{--accent: #7c3aed;--accent-2: #6366f1;--bg: #f6f7fb;--card: rgba(255,255,255,.75);--glass-border: rgba(200,200,200,.18);--glass-shadow: 0 12px 34px rgba(18,25,40,.12);--radius-lg: 14px;--radius-md: 10px;--muted: #6b7280;--success: #10b981;--danger: #ef4444;--glass-blur: 10px;--transition: .22s cubic-bezier(.2,.9,.25,1);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}*[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[_nghost-%COMP%]{display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff9;backdrop-filter:blur(4px);z-index:1000;overflow-y:auto;overflow-x:hidden;animation:_ngcontent-%COMP%_backdropIn .26s var(--transition)}@keyframes _ngcontent-%COMP%_backdropIn{0%{opacity:0}to{opacity:1}}.modal[_ngcontent-%COMP%]{width:auto;max-width:50vh;max-height:90vh;border-radius:var(--radius-lg);background:linear-gradient(180deg,#fffffff2,#ffffffe6);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);backdrop-filter:blur(var(--glass-blur)) saturate(125%);overflow:hidden;display:flex;flex-direction:column;transform-origin:center;animation:_ngcontent-%COMP%_pop .26s var(--transition)}@keyframes _ngcontent-%COMP%_pop{0%{transform:translateY(10px) scale(.995);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 15px;border-bottom:1px solid rgba(15,23,42,.04);background:linear-gradient(90deg,#fff6,#fff3)}.title-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.modal-title[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:700;color:#0b1220;display:flex;align-items:center;gap:10px}.pill-meta[_ngcontent-%COMP%]{font-size:.82rem;color:var(--muted);background:#6366f114;padding:6px 9px;border-radius:999px}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.btn-icon[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer;padding:8px;border-radius:8px;color:var(--muted);transition:all var(--transition);display:inline-flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]:hover{background:#0f172a0a;color:var(--accent);transform:translateY(-2px)}.modal-body[_ngcontent-%COMP%]{padding:18px;align-items:center;overflow-y:auto;overflow-x:hidden}.form-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.input-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);border-radius:12px;padding:4px;border:1px solid rgba(15,23,42,.03);transition:box-shadow var(--transition),transform var(--transition)}.input-card[_ngcontent-%COMP%]:focus-within{box-shadow:0 10px 30px #6366f112;transform:translateY(-2px)}.label-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.label-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--muted);font-weight:600}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:#94a3b8}.field[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;border:1px solid rgba(15,23,42,.04);background:#fff9}.field.focus[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 8px 20px #6366f117;transform:translateY(-2px)}.field[_ngcontent-%COMP%]   .fi-icon[_ngcontent-%COMP%]{color:#94a3b8;font-size:18px;margin-left:2px}.field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:.96rem;color:inherit;width:100%}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;padding-top:4px}.floating-label[_ngcontent-%COMP%]{position:absolute;top:10px;left:48px;font-size:.9rem;color:var(--muted);pointer-events:none;transform-origin:left top;transition:all var(--transition);background:linear-gradient(90deg,#fffffff2,#fffffff2);padding:0 6px;border-radius:6px}.field.filled[_ngcontent-%COMP%]   .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus + .floating-label[_ngcontent-%COMP%]{transform:translateY(-22px) scale(.84);color:var(--accent)}.row-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.tag-picker[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap;font-size:12px}.tag-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 4px;border-radius:999px;background:linear-gradient(180deg,#ffffffb3,#ffffff80);border:1px solid rgba(15,23,42,.267);font-weight:600;cursor:pointer;transition:all var(--transition)}.tag-chip[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;box-shadow:0 2px 6px #0000000f}.tag-chip[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.tag-editor[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;margin-top:8px}.assignees[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:24px;font-size:11px;height:24px;border-radius:50%;display:inline-grid;place-items:center;font-weight:700;color:#fff;box-shadow:0 4px 12px #02061714;cursor:pointer}.avatar.small[_ngcontent-%COMP%]{width:18px;height:18px;font-size:8px}.avatar-list[_ngcontent-%COMP%]{display:flex;gap:2px;margin-top:6px;max-width:250px;overflow-x:scroll}.assignee-input[_ngcontent-%COMP%]{min-width:50px;padding:6px 10px;border-radius:12px;border:1px solid rgba(15,23,42,.397);background:#fff9}.assignee1[_ngcontent-%COMP%]{width:110px}.assignee2[_ngcontent-%COMP%]{width:160px}.checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;margin-top:2px}.ck-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;background:linear-gradient(180deg,#fff9,#ffffff8c);padding:0 2px;border-radius:10px;border:1px solid rgba(15,23,42,.26);transition:all var(--transition);cursor:grab}.ck-item[dragging=true][_ngcontent-%COMP%]{opacity:.6;transform:scale(.995)}.ck-item[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem}.ck-controls[_ngcontent-%COMP%]{display:flex;gap:3px;align-items:center}.dropzone[_ngcontent-%COMP%]{border:2px dashed rgba(15,23,42,.06);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;min-height:54px;transition:all var(--transition);background:linear-gradient(180deg,#ffffffa6,#fff9)}.dropzone.dragover[_ngcontent-%COMP%]{border-color:var(--accent);box-shadow:0 10px 30px #6366f10f}.file-preview[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;padding:8px 10px;border-radius:10px;background:#fff9;border:1px solid rgba(15,23,42,.03)}.file-thumb[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:8px;background:#eef2ff;display:grid;place-items:center;font-weight:700}.file-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#0b1220}.remove-file[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--danger);cursor:pointer}.file-size[_ngcontent-%COMP%]{font-size:.78rem;color:#64748b}.meta-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;position:relative}.card[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffffb3,#fff9);border:1px solid rgba(15,23,42,.03)}.preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-start}.meta-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px;align-items:center}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding:14px 18px;border-top:1px solid rgba(15,23,42,.04);flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;border:none;box-shadow:0 6px 18px #0206170a;transition:all var(--transition)}.btn.secondary[_ngcontent-%COMP%]{background:#f8fafc;color:#0b1220}.btn.primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 12px 30px #7c3aed2e}.btn.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(15,23,42,.04)}.muted[_ngcontent-%COMP%]{color:var(--muted);font-size:.85rem}.small[_ngcontent-%COMP%]{font-size:.82rem}.flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}@media (max-width: 980px){.modal[_ngcontent-%COMP%]{width:100%;max-width:95vw;max-height:95vh}.modal-body[_ngcontent-%COMP%]{grid-template-columns:1fr}.meta-col[_ngcontent-%COMP%]{order:2;width:100%}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.tag-picker[_ngcontent-%COMP%], .assignees[_ngcontent-%COMP%], .ck-item[_ngcontent-%COMP%]{flex-wrap:wrap;width:100%}.dropzone[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();function Ke(a,l){if(1&a&&t.nrm(0,"div",23),2&a){const e=t.XpG(5);t.xc7("height",e.draggedTaskHeight||50,"px")}}function Je(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",20),t.DNE(1,Ke,1,2,"div",19),t.j41(2,"div",21),t.bIt("dragstart",function(i){const o=t.eBV(e),s=o.$implicit,r=o.index,d=t.XpG(2).$implicit,u=t.XpG(2);return t.Njj(u.onDragTaskStart(i,s,r,d.id))})("dragend",function(i){t.eBV(e);const o=t.XpG(4);return t.Njj(o.onDragTaskEnd(i))}),t.j41(3,"app-task-builder",22),t.bIt("onEditTask",function(i){t.eBV(e);const o=t.XpG(4);return t.Njj(o.editTask(i))})("onDeleteTask",function(i){t.eBV(e);const o=t.XpG(4);return t.Njj(o.deleteTask(i))})("onShareTask",function(i){t.eBV(e);const o=t.XpG(4);return t.Njj(o.shareTask(i))})("onAssignTask",function(i){t.eBV(e);const o=t.XpG(4);return t.Njj(o.assignTask(i))}),t.k0s()()()}if(2&a){const e=l.$implicit,n=l.index,i=t.XpG(2).$implicit,o=t.XpG(2);t.R7$(),t.Y8G("ngIf",o.getPlaceholderIndex(i.id)===n),t.R7$(2),t.Y8G("task",e)("columnId",i.id)}}function qe(a,l){if(1&a&&t.nrm(0,"div",23),2&a){const e=t.XpG(4);t.xc7("height",e.draggedTaskHeight||50,"px")}}function Ze(a,l){if(1&a&&(t.qex(0),t.DNE(1,Je,4,3,"div",18)(2,qe,1,2,"div",19),t.bVm()),2&a){const e=t.XpG().$implicit,n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.getColumnTaks(e.id))("ngForTrackBy",n.trackById),t.R7$(),t.Y8G("ngIf",n.getPlaceholderIndex(e.id)===n.getColumnTaks(e.id).length)}}function tn(a,l){if(1&a&&t.nrm(0,"div",23),2&a){const e=t.XpG(4);t.xc7("height",e.draggedTaskHeight||50,"px")}}function en(a,l){if(1&a&&t.DNE(0,tn,1,2,"div",19),2&a){const e=t.XpG().$implicit,n=t.XpG(2);t.Y8G("ngIf",0===n.getPlaceholderIndex(e.id))}}function nn(a,l){if(1&a){const e=t.RV6();t.j41(0,"div",10),t.bIt("dragover",function(i){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.onDragOverColumn(i,o.id,s.getColumnTaks(o.id)))})("dragleave",function(i){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.onDragLeaveColumn(i,o.id))})("drop",function(i){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.onDropInColumn(i,o.id,s.getColumnTaks(o.id)))}),t.j41(1,"div",11)(2,"div",12),t.nrm(3,"span",13),t.EFF(4),t.j41(5,"span",14),t.EFF(6),t.k0s()(),t.nrm(7,"div",15),t.k0s(),t.j41(8,"button",16),t.bIt("click",function(){const i=t.eBV(e).$implicit,o=t.XpG(2);return t.Njj(o.addTask(i.id))}),t.EFF(9,"+ Add New Task"),t.k0s(),t.DNE(10,Ze,3,3,"ng-container",17)(11,en,1,1,"ng-template",null,1,t.C5r),t.k0s()}if(2&a){const e=l.$implicit,n=t.sdS(12),i=t.XpG(2);t.AVh("expanded",i.dragOverColId===e.id),t.R7$(3),t.xc7("background",e.color),t.R7$(),t.SpI("",e.title," "),t.R7$(2),t.JRh(i.getColumnTaks(e.id).length),t.R7$(4),t.Y8G("ngIf",i.getColumnTaks(e.id).length>0)("ngIfElse",n)}}function on(a,l){if(1&a){const e=t.RV6();t.j41(0,"app-task-modal",24),t.bIt("save",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.saveTask(i))})("close",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.closeModal(i))}),t.k0s()}if(2&a){const e=t.XpG(2);t.Y8G("task",e.selectedTask)("columnId",e.modalColumnId)("userId",e.userId)}}function an(a,l){if(1&a){const e=t.RV6();t.j41(0,"section",3)(1,"div",4)(2,"h3",5),t.EFF(3,"Filtrer les t\xe2ches "),t.j41(4,"i",6),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openFilterModal())}),t.k0s(),t.EFF(5," ("),t.j41(6,"b"),t.EFF(7),t.k0s(),t.EFF(8,")"),t.k0s(),t.j41(9,"div",7),t.DNE(10,nn,13,8,"div",8),t.k0s()(),t.DNE(11,on,1,3,"app-task-modal",9),t.k0s()}if(2&a){const e=t.XpG();t.R7$(7),t.JRh(e.filterCount),t.R7$(3),t.Y8G("ngForOf",e.columns)("ngForTrackBy",e.trackByColumn),t.R7$(),t.Y8G("ngIf",e.modalOpen)}}function sn(a,l){1&a&&(t.j41(0,"div",25),t.EFF(1,"No columns available"),t.k0s())}const rn=[{path:"",component:(()=>{class a{constructor(e,n,i,o,s){this.taskService=e,this.columnService=n,this.userCtx=i,this.dialog=o,this.provider=s,this.columns=[],this.tasksMap={},this.modalOpen=!1,this.selectedTask=null,this.openMenuId=null,this.draggedTask=null,this.dragOverColId=null,this.ghostEl=null,this.draggedTaskHeight=null,this.draggedFrom=null,this.dropIndex=null,this.filter={priority:null,assigned:null,tag:null,startDate:null,endDate:null},this.filterCount=0,this.originalDragEl=null,this.lastDragOver=0,this.placeholderIndexMap={},this.userId=this.userCtx.requireUser()?.uid}ngOnInit(){var e=this;return(0,c.A)(function*(){e.columns=yield e.columnService.list(),yield e.generateTasks()})()}openFilterModal(){this.dialog.open(Ht,{width:"500px",maxHeight:"80vh",data:{userId:this.userId,filter:this.filter}}).afterClosed().subscribe(n=>{n&&(this.filterCount=(n.priority&&n.priority.length>0?1:0)+(n.assigned&&n.assigned.length>0?1:0)+(n.tag&&n.tag.length>0?1:0)+(n.startDate&&n.startDate.length>0?1:0),this.filter=n,this.generateTasks())})}generateTasks(){var e=this;return(0,c.A)(function*(n=!1){let i=[];try{const p=e.columns.map(g=>g.id);i=yield e.taskService.bulkGet({field:"columnId",value:p},n)}catch(p){console.error("Failed to load tasks:",p),i=[]}const{priority:o,assigned:s,tag:r,startDate:d,endDate:u}=e.filter,h=i.filter(p=>{if(1==p.deleted)return!1;let g=!0;if(p.priority||(p.priority=e.provider.defaultPriority),o&&o.length>0&&!o.includes(p.priority.id)&&(g=!1),s&&s.length>0){const b=p.assignTo?Object.keys(p.assignTo):[];s.some(M=>b.includes(M))||(g=!1)}return r&&r.length>0&&(r.includes("object"==typeof p.tag?p.tag.id:p.tag)||(g=!1)),d&&p.due&&p.due>=new Date(d).getTime()&&(g=!1),u&&p.due&&p.due<=new Date(u).getTime()&&(g=!1),g});for(const p of e.columns){if(!p?.id)continue;const g=h.filter(b=>b.columnId===p.id).sort((b,v)=>{const M=b.order??Number.MAX_SAFE_INTEGER,B=v.order??Number.MAX_SAFE_INTEGER;return M!==B?M-B:(b.updatedAt??0)-(v.updatedAt??0)});e.tasksMap[p.id]=g.length>0?g:[]}}).apply(this,arguments)}getColumnTaks(e){return this.tasksMap[e]||[]}getPlaceholderIndex(e){return this.dropIndex?.colId===e?this.dropIndex.taskIndex:null}onDragTaskStart(e,n,i,o){if(!e.dataTransfer)return;const s=e.target;this.originalDragEl=s,this.draggedTask=n,this.draggedFrom={colId:o,index:i},this.draggedTaskHeight=s.offsetHeight;const r=s.cloneNode(!0);r.classList.add("ghost-clone"),r.style.position="absolute",r.style.top="-9999px",r.style.left="0",r.style.pointerEvents="none",r.style.zIndex="999999",r.style.opacity="1",r.style.transformOrigin="center center",r.style.boxShadow="0 10px 30px rgba(0,0,0,0.25)",r.style.borderRadius=window.getComputedStyle(s).borderRadius||"4px",r.style.width=`${s.offsetWidth}px`,r.style.height=`${s.offsetHeight}px`,r.style.overflow="hidden",document.body.appendChild(r),this.ghostEl=r,e.dataTransfer.setDragImage(r,120,30),e.dataTransfer.effectAllowed="move",requestAnimationFrame(()=>{try{const d=Math.round(r.offsetWidth/2),u=Math.round(r.offsetHeight/2);e.dataTransfer?.setDragImage(r,d,u)}catch{}s.classList.add("drag-source-hidden")})}onDragTaskEnd(e){this.cleanupDrag(e)}onDragOverColumn(e,n,i){if(e.preventDefault(),!this.draggedTask)return;const o=performance.now();if(o-(this.lastDragOver??0)<12)return;this.lastDragOver=o,this.dragOverColId=n;const s=e.currentTarget;if(!s)return;const r=s.getBoundingClientRect(),d=(e.clientY??0)-r.top,u=Array.from(s.querySelectorAll(".task-item")).filter(g=>!g.classList.contains("drag-source-hidden"));let h=u.length;if(0===u.length)h=0;else for(let g=0;g<u.length;g++){const b=u[g].getBoundingClientRect();if(d<b.top-r.top+b.height/2){h=g;break}}let p=h;if(this.draggedFrom?.colId===n&&Number.isFinite(this.draggedFrom.index)){const g=this.draggedFrom.index;p=u.length===Math.max(0,(i?.length??0)-1)?h>g?h+1:h:h>g?h-1:h}p=Math.max(0,Math.min(p,i?.length??0)),this.dropIndex={colId:n,taskIndex:p}}onDropInColumn(e,n,i){var o=this;return(0,c.A)(function*(){if(e.preventDefault(),!o.draggedTask||!o.draggedFrom||!o.dropIndex)return;const s=o.draggedFrom.index,r=o.dropIndex.taskIndex;o.draggedFrom.colId!==n||s!==r?(yield o.taskService.moveTask(o.draggedTask.id,n,s,r),yield o.generateTasks(),o.cleanupDrag(e)):o.cleanupDrag(e)})()}onDragLeaveColumn(e,n){this.dragOverColId===n&&(this.dragOverColId=null)}cleanupDrag(e){this.originalDragEl&&(this.originalDragEl.classList.remove("drag-source-hidden"),this.originalDragEl=null),this.ghostEl&&(this.ghostEl.remove(),this.ghostEl=null),this.dragOverColId=null,this.draggedTask=null,this.dropIndex=null,this.placeholderIndexMap={},this.draggedFrom=null,this.draggedTaskHeight=null}addTask(e){this.selectedTask=null,this.modalColumnId=e,this.modalOpen=!0}editTask(e){this.selectedTask=e,this.modalColumnId=e.columnId,this.modalOpen=!0}deleteTask(e){var n=this;return(0,c.A)(function*(){try{(yield n.taskService.save({...e,deleted:!0}))&&(yield n.generateTasks())}catch{}})()}saveTask(e){var n=this;return(0,c.A)(function*(){try{(yield n.taskService.save(e))&&(yield n.generateTasks(),n.modalOpen=!1,console.log("SAVE PAYLOAD",e))}catch{}})()}closeModal(e){this.modalOpen=!1}shareTask(e){console.log("Share task",e)}assignTask(e){console.log("Assign task",e)}toggleMenu(e,n){n.stopPropagation(),this.openMenuId=this.openMenuId===e?null:e}assignColumn(e,n){n?.stopPropagation(),console.log("Assign column",e)}shareColumn(e,n){n?.stopPropagation(),console.log("Share column",e)}editColumn(e,n){n?.stopPropagation(),console.log("Edit column",e)}deleteColumn(e,n){n?.stopPropagation(),console.log("Delete column",e)}trackById(e,n){return n.id}trackByColumn(e,n){return n.id}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(j),t.rXU(Qt),t.rXU(x.i),t.rXU(A),t.rXU(w))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-tasks"]],standalone:!1,decls:3,vars:2,consts:[["emptyBoard",""],["emptyCol",""],["class","board","role","region","aria-label","Board",4,"ngIf","ngIfElse"],["role","region","aria-label","Board",1,"board"],[1,"board-columns"],[2,"margin","0px","padding","0px"],[1,"fas","fa-plus-circle",2,"cursor","pointer",3,"click"],[1,"task-colums"],["class","column",3,"expanded","dragover","dragleave","drop",4,"ngFor","ngForOf","ngForTrackBy"],[3,"task","columnId","userId","save","close",4,"ngIf"],[1,"column",3,"dragover","dragleave","drop"],[1,"column-header"],[1,"title"],[1,"dot"],[1,"count"],[1,"meta"],[1,"add-btn",3,"click"],[4,"ngIf","ngIfElse"],["class","task-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],["class","drop-placeholder",3,"height",4,"ngIf"],[1,"task-wrapper"],["draggable","true",1,"task-item",3,"dragstart","dragend"],[3,"onEditTask","onDeleteTask","onShareTask","onAssignTask","task","columnId"],[1,"drop-placeholder"],[3,"save","close","task","columnId","userId"],[1,"empty-message"]],template:function(n,i){if(1&n&&t.DNE(0,an,12,4,"section",2)(1,sn,2,0,"ng-template",null,0,t.C5r),2&n){const o=t.sdS(2);t.Y8G("ngIf",i.columns.length>0)("ngIfElse",o)}},dependencies:[m.Sq,m.bT,ze,We],styles:['@charset "UTF-8";.board-columns[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;align-items:flex-start}.task-colums[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px;align-items:flex-start}.column[_ngcontent-%COMP%]{width:280px;background:transparent;border-radius:12px;padding:12px;min-height:300px;height:100%;transition:height .18s ease,background-color .18s ease,border .18s ease}.column.expanded[_ngcontent-%COMP%]{min-height:500px;background-color:#f9f9f9}.column-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-weight:700;color:#0b2547}.dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:inline-block}.count[_ngcontent-%COMP%]{background:#fff;padding:1px 12px;border-radius:999px;box-shadow:var(--shadow);font-weight:700}.meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:var(--muted)}.meta[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.add-btn[_ngcontent-%COMP%]{width:100%;background:#fff;border:1px dashed rgba(15,23,42,.06);padding:10px;margin-bottom:12px;border-radius:8px;color:#2b5bf6;font-weight:700;cursor:pointer}@media (max-width: 900px){.board-columns[_ngcontent-%COMP%]{flex-direction:column;gap:16px;align-items:stretch}.column[_ngcontent-%COMP%]{width:100%;max-width:100%;background:#fff;border:1px solid rgba(15,23,42,.08);box-shadow:var(--shadow-sm)}.column-header[_ngcontent-%COMP%]{position:sticky;top:0;background:#fff;padding:8px 0;z-index:2}.add-btn[_ngcontent-%COMP%]{font-size:14px}}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;z-index:200}.modal[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}.drop-placeholder[_ngcontent-%COMP%]{border:2px dashed #3b82f6;border-radius:6px;height:50px;background-color:#eff6ff55;transition:all .2s ease}.task-item[_ngcontent-%COMP%]{transition:all .3s ease}.drag-source-hidden[_ngcontent-%COMP%]{opacity:0;height:0!important;margin:0!important;padding:0!important;transform:scale(.95);overflow:hidden}.ghost-clone[_ngcontent-%COMP%]{transition:transform .12s ease;will-change:transform,opacity}.task-item.move-up[_ngcontent-%COMP%]{transform:translateY(-20px)}.task-item.move-down[_ngcontent-%COMP%]{transform:translateY(20px)}.task-item.dropped[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_dropIn .3s ease-out}@keyframes _ngcontent-%COMP%_dropIn{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.more-options[_ngcontent-%COMP%]{position:relative}.more-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;font-size:18px;padding:2px 6px;color:var(--muted)}.more-btn[_ngcontent-%COMP%]:hover{color:var(--accent)}.more-menu[_ngcontent-%COMP%]{position:absolute;top:120%;right:0;background:var(--card);box-shadow:var(--shadow);border-radius:6px;flex-direction:column;min-width:120px;z-index:20}.more-menu.show[_ngcontent-%COMP%]{display:flex}.more-menu[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{padding:8px 12px;border:none;background:none;text-align:left;cursor:pointer}.more-menu[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]:hover{background:#f0f4ff}']})}}return a})(),canActivate:[kt.q]}];let ln=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[K.iI.forChild(rn),K.iI]})}}return a})(),dn=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[m.MD,_.YN,_.X1,ln,bt.G,W.q1]})}}return a})()}}]);